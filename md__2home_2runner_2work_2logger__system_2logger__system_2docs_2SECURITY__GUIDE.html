<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Logger System: Security Module Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Logger System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-performance C++20 thread-safe logging system with asynchronous capabilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__2home_2runner_2work_2logger__system_2logger__system_2docs_2SECURITY__GUIDE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Security Module Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2613"></a> <b>logger_system Security Module</b> (<code>include/kcenon/logger/security/</code>)</p>
<p>The security module provides defense-in-depth capabilities for logging infrastructure, protecting against common security threats while maintaining compliance requirements.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md2615"></a>
Table of Contents</h1>
<ol type="1">
<li>Overview</li>
<li>Threat Model</li>
<li>Architecture</li>
<li>Audit Logger</li>
<li>Log Sanitizer</li>
<li>Path Validator</li>
<li>Secure Key Storage</li>
<li>Signal Manager</li>
<li>Configuration Examples</li>
<li>Compliance Considerations</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md2617"></a>
Overview</h1>
<h2><a class="anchor" id="autotoc_md2618"></a>
Purpose</h2>
<p>The security module implements multiple layers of defense to protect logging infrastructure:</p>
<ul>
<li><b>Tamper detection</b> — HMAC-signed audit logs for integrity verification</li>
<li><b>Data privacy</b> — Automatic PII/sensitive data scrubbing</li>
<li><b>Path security</b> — Prevention of path traversal and symlink attacks</li>
<li><b>Key management</b> — Secure storage and retrieval of encryption keys</li>
<li><b>Graceful shutdown</b> — Signal handling for emergency log flushing</li>
</ul>
<h2><a class="anchor" id="autotoc_md2619"></a>
Components</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">Header   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Audit Logger   </td><td class="markdownTableBodyNone"><code>audit_logger.h</code>   </td><td class="markdownTableBodyNone">Tamper-evident audit logging with HMAC signatures    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Log Sanitizer   </td><td class="markdownTableBodyNone"><code>log_sanitizer.h</code>   </td><td class="markdownTableBodyNone">PII/sensitive data detection and masking    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Path Validator   </td><td class="markdownTableBodyNone"><code>path_validator.h</code>   </td><td class="markdownTableBodyNone">Path traversal prevention and filename validation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Secure Key Storage   </td><td class="markdownTableBodyNone"><code>secure_key_storage.h</code>   </td><td class="markdownTableBodyNone">Secure key generation, storage, and retrieval    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Signal Manager   </td><td class="markdownTableBodyNone"><code>signal_manager.h</code>   </td><td class="markdownTableBodyNone">Signal-safe emergency log flushing    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Signal Manager Interface   </td><td class="markdownTableBodyNone"><code>signal_manager_interface.h</code>   </td><td class="markdownTableBodyNone">Abstraction for dependency injection   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md2621"></a>
Threat Model</h1>
<h2><a class="anchor" id="autotoc_md2622"></a>
Threats Defended Against</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Threat   </th><th class="markdownTableHeadNone">Defense Mechanism   </th><th class="markdownTableHeadNone">Components    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Log tampering</b>   </td><td class="markdownTableBodyNone">HMAC-signed audit entries   </td><td class="markdownTableBodyNone">Audit Logger    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Data leakage</b>   </td><td class="markdownTableBodyNone">PII detection and masking   </td><td class="markdownTableBodyNone">Log Sanitizer    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Path traversal</b>   </td><td class="markdownTableBodyNone">Canonical path validation   </td><td class="markdownTableBodyNone">Path Validator    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Symlink attacks</b>   </td><td class="markdownTableBodyNone">Symlink resolution and checking   </td><td class="markdownTableBodyNone">Path Validator    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Insecure key storage</b>   </td><td class="markdownTableBodyNone">File permission enforcement (0600)   </td><td class="markdownTableBodyNone">Secure Key Storage    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Data loss on crash</b>   </td><td class="markdownTableBodyNone">Signal-safe emergency flush   </td><td class="markdownTableBodyNone">Signal Manager    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Unauthorized access</b>   </td><td class="markdownTableBodyNone">Directory-based access control   </td><td class="markdownTableBodyNone">Path Validator, Secure Key Storage   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md2623"></a>
Security Assumptions</h2>
<ul>
<li><b>File system security</b> — Host OS enforces file permissions correctly</li>
<li><b>Process isolation</b> — Each process has its own secure key storage area</li>
<li><b>Cryptographic library trust</b> — OpenSSL (if available) provides secure HMAC and random generation</li>
<li><b>Signal handling</b> — OS signal delivery is reliable</li>
</ul>
<h2><a class="anchor" id="autotoc_md2624"></a>
Out of Scope</h2>
<ul>
<li><b>Network security</b> — No network-based log transmission protection (use TLS at transport layer)</li>
<li><b>Encryption at rest</b> — Use <code>encrypted_writer</code> for log file encryption (see <code>ENCRYPTION.md</code>)</li>
<li><b>Authentication</b> — No user identity verification (handled by application layer)</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md2626"></a>
Architecture</h1>
<h2><a class="anchor" id="autotoc_md2627"></a>
Component Integration</h2>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────┐</div>
<div class="line">│                    Application Code                      │</div>
<div class="line">└───────────────────────────┬─────────────────────────────┘</div>
<div class="line">                            │</div>
<div class="line">                            ▼</div>
<div class="line">┌─────────────────────────────────────────────────────────┐</div>
<div class="line">│                     logger_builder                       │</div>
<div class="line">│  .with_audit()  .with_sanitizer()  .with_path_validator()│</div>
<div class="line">└───────────────────────────┬─────────────────────────────┘</div>
<div class="line">                            │</div>
<div class="line">        ┌───────────────────┼───────────────────┐</div>
<div class="line">        ▼                   ▼                   ▼</div>
<div class="line">┌──────────────┐    ┌──────────────┐    ┌──────────────┐</div>
<div class="line">│ Audit Logger │    │Log Sanitizer │    │Path Validator│</div>
<div class="line">│              │    │              │    │              │</div>
<div class="line">│ - HMAC sign  │    │ - PII detect │    │ - Path check │</div>
<div class="line">│ - JSON logs  │    │ - Data mask  │    │ - Symlink    │</div>
<div class="line">└──────────────┘    └──────────────┘    └──────────────┘</div>
<div class="line">        │                                       │</div>
<div class="line">        ▼                                       ▼</div>
<div class="line">┌──────────────────────────────────────────────────────────┐</div>
<div class="line">│              Secure Key Storage                          │</div>
<div class="line">│  - Key generation (RAND_bytes)                           │</div>
<div class="line">│  - Key persistence (0600 permissions)                    │</div>
<div class="line">│  - Path traversal prevention                             │</div>
<div class="line">└──────────────────────────────────────────────────────────┘</div>
<div class="line"> </div>
<div class="line">┌──────────────────────────────────────────────────────────┐</div>
<div class="line">│              Signal Manager                              │</div>
<div class="line">│  - SIGSEGV/SIGABRT/SIGTERM/SIGINT handlers               │</div>
<div class="line">│  - Signal-safe emergency flush                           │</div>
<div class="line">│  - Logger registration                                   │</div>
<div class="line">└──────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2628"></a>
Dependency Graph</h2>
<ul>
<li><b>Audit Logger</b> → Secure Key Storage (HMAC key)</li>
<li><b>Path Validator</b> → Error Codes</li>
<li><b>Secure Key Storage</b> → Error Codes, OpenSSL (optional)</li>
<li><b>Signal Manager</b> → Signal Manager Interface, Critical Logger Interface</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md2630"></a>
Audit Logger</h1>
<p><b>Header:</b> <code>include/kcenon/logger/security/audit_logger.h</code></p>
<h2><a class="anchor" id="autotoc_md2631"></a>
Purpose</h2>
<p>Creates tamper-evident audit logs with HMAC signatures for compliance and forensic analysis.</p>
<h2><a class="anchor" id="autotoc_md2632"></a>
Key Features</h2>
<ul>
<li><b>JSON-formatted entries</b> — Structured logs for easy parsing and analysis</li>
<li><b>HMAC signatures</b> — Cryptographic integrity verification (SHA-256)</li>
<li><b>Thread-safe logging</b> — Safe for concurrent access</li>
<li><b>ISO 8601 timestamps</b> — Standardized time representation</li>
<li><b>OpenSSL 3.x and 1.1.x support</b> — Adapts to available OpenSSL version</li>
</ul>
<h2><a class="anchor" id="autotoc_md2633"></a>
Audit Event Types</h2>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> audit_event {</div>
<div class="line">    logger_started,                    <span class="comment">// Logger initialization</span></div>
<div class="line">    logger_stopped,                    <span class="comment">// Logger shutdown</span></div>
<div class="line">    writer_added,                      <span class="comment">// Writer registered</span></div>
<div class="line">    writer_removed,                    <span class="comment">// Writer unregistered</span></div>
<div class="line">    encryption_key_loaded,             <span class="comment">// Encryption key loaded from file</span></div>
<div class="line">    encryption_key_rotated,            <span class="comment">// Encryption key rotated</span></div>
<div class="line">    encryption_key_generated,          <span class="comment">// New encryption key generated</span></div>
<div class="line">    permission_denied,                 <span class="comment">// Access denied (file, resource)</span></div>
<div class="line">    path_traversal_attempt,            <span class="comment">// Path traversal detected</span></div>
<div class="line">    insecure_permissions_detected,     <span class="comment">// File permissions too permissive</span></div>
<div class="line">    suspicious_activity,               <span class="comment">// Generic security alert</span></div>
<div class="line">    configuration_changed,             <span class="comment">// Logger configuration modified</span></div>
<div class="line">    authentication_success,            <span class="comment">// Authentication succeeded</span></div>
<div class="line">    authentication_failure,            <span class="comment">// Authentication failed</span></div>
<div class="line">    file_access_denied,                <span class="comment">// File access denied</span></div>
<div class="line">    file_access_granted                <span class="comment">// File access granted</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2634"></a>
API</h2>
<h3><a class="anchor" id="autotoc_md2635"></a>
Initialize Audit Logger</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> audit_logger::initialize(</div>
<div class="line">    <span class="keyword">const</span> std::filesystem::path&amp; audit_file,</div>
<div class="line">    <span class="keyword">const</span> secure_key* hmac_key = <span class="keyword">nullptr</span></div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><code>audit_file</code> — Path to audit log file (created with 0600 permissions)</li>
<li><code>hmac_key</code> — Optional HMAC key for tamper detection (recommended)</li>
</ul>
<p><b>Behavior:</b></p><ul>
<li>Creates parent directory if needed</li>
<li>Sets secure file permissions (owner read/write only)</li>
<li>Copies HMAC key if provided</li>
</ul>
<h3><a class="anchor" id="autotoc_md2636"></a>
Log an Audit Event</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> audit_logger::log_audit_event(</div>
<div class="line">    audit_event event,</div>
<div class="line">    <span class="keyword">const</span> std::string&amp; details,</div>
<div class="line">    <span class="keyword">const</span> std::map&lt;std::string, std::string&gt;&amp; metadata = {}</div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><code>event</code> — Type of security event (see <code>audit_event</code> enum)</li>
<li><code>details</code> — Human-readable description</li>
<li><code>metadata</code> — Optional key-value pairs for additional context</li>
</ul>
<p><b>Output format:</b> </p><div class="fragment"><div class="line">{&quot;timestamp&quot;:&quot;2025-02-09T14:30:45&quot;,&quot;event&quot;:&quot;encryption_key_loaded&quot;,&quot;details&quot;:&quot;Loaded AES-256 key from /var/log/keys/master.key&quot;,&quot;metadata&quot;:{&quot;key_size&quot;:&quot;32&quot;,&quot;algorithm&quot;:&quot;AES-256-GCM&quot;}}</div>
<div class="line">SIGNATURE:a3f5d8c92b1e... (if HMAC key provided)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2637"></a>
Verify Entry Integrity</h3>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> audit_logger::verify_entry(</div>
<div class="line">    <span class="keyword">const</span> std::string&amp; json_entry,</div>
<div class="line">    <span class="keyword">const</span> std::string&amp; signature</div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Returns:</b> <code>true</code> if signature matches, <code>false</code> otherwise</p>
<p><b>Use case:</b> Verify audit log integrity after-the-fact (forensic analysis)</p>
<h2><a class="anchor" id="autotoc_md2638"></a>
Example Usage</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/audit_logger.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/secure_key_storage.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Generate HMAC key for audit log integrity</span></div>
<div class="line"><span class="keyword">auto</span> hmac_key_result = secure_key_storage::generate_key(32);</div>
<div class="line"><span class="keywordflow">if</span> (hmac_key_result.is_err()) {</div>
<div class="line">    <span class="comment">// Handle error</span></div>
<div class="line">}</div>
<div class="line">secure_key hmac_key = std::move(hmac_key_result).unwrap();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Save key for future verification</span></div>
<div class="line">secure_key_storage::save_key(hmac_key, <span class="stringliteral">&quot;/var/log/keys/audit_hmac.key&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize audit logger</span></div>
<div class="line">audit_logger::initialize(<span class="stringliteral">&quot;/var/log/audit/security.log&quot;</span>, &amp;hmac_key);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Log security-relevant events</span></div>
<div class="line">audit_logger::log_audit_event(</div>
<div class="line">    audit_event::encryption_key_loaded,</div>
<div class="line">    <span class="stringliteral">&quot;Loaded master encryption key&quot;</span>,</div>
<div class="line">    {{<span class="stringliteral">&quot;key_id&quot;</span>, <span class="stringliteral">&quot;master-key-2025-02-09&quot;</span>}, {<span class="stringliteral">&quot;algorithm&quot;</span>, <span class="stringliteral">&quot;AES-256-GCM&quot;</span>}}</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line">audit_logger::log_audit_event(</div>
<div class="line">    audit_event::permission_denied,</div>
<div class="line">    <span class="stringliteral">&quot;User attempted to write to restricted directory&quot;</span>,</div>
<div class="line">    {{<span class="stringliteral">&quot;user&quot;</span>, <span class="stringliteral">&quot;jdoe&quot;</span>}, {<span class="stringliteral">&quot;path&quot;</span>, <span class="stringliteral">&quot;/root/restricted&quot;</span>}}</div>
<div class="line">);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2639"></a>
Compliance Considerations</h2>
<ul>
<li><b>SOX (Sarbanes-Oxley)</b> — Tamper-evident audit logs for financial systems</li>
<li><b>HIPAA</b> — Audit trail for healthcare data access</li>
<li><b>GDPR</b> — Data processing activity logs</li>
<li><b>PCI-DSS</b> — Security event monitoring (Requirement 10.x)</li>
</ul>
<p><b>Best practices:</b></p><ul>
<li>Rotate audit logs regularly (daily or weekly)</li>
<li>Store HMAC keys securely (separate from audit logs)</li>
<li>Verify signatures periodically to detect tampering</li>
<li>Archive audit logs to immutable storage (S3 Glacier, tape)</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md2641"></a>
Log Sanitizer</h1>
<p><b>Header:</b> <code>include/kcenon/logger/security/log_sanitizer.h</code></p>
<h2><a class="anchor" id="autotoc_md2642"></a>
Purpose</h2>
<p>Automatically detects and masks sensitive data (PII, credentials, financial information) in log messages to prevent data leakage.</p>
<h2><a class="anchor" id="autotoc_md2643"></a>
Key Features</h2>
<ul>
<li><b>Built-in patterns</b> — Credit cards, SSNs, API keys, passwords, emails, IPs, phone numbers</li>
<li><b>Custom patterns</b> — Add regex-based rules for organization-specific sensitive data</li>
<li><b>Partial preservation</b> — Keep last N characters visible (e.g., last 4 digits of credit card)</li>
<li><b>Thread-safe</b> — Safe for concurrent use</li>
<li><b>Zero configuration</b> — Use <code>make_default_sanitizer()</code> for quick setup</li>
</ul>
<h2><a class="anchor" id="autotoc_md2644"></a>
Sensitive Data Types</h2>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> sensitive_data_type {</div>
<div class="line">    credit_card,     <span class="comment">// Visa, MC, Amex (masks all but last 4)</span></div>
<div class="line">    ssn,             <span class="comment">// US Social Security Numbers (masks all but last 4)</span></div>
<div class="line">    api_key,         <span class="comment">// API keys (sk-, api_, bearer tokens) — fully redacted</span></div>
<div class="line">    password,        <span class="comment">// Password fields (password=xxx) — fully redacted</span></div>
<div class="line">    email,           <span class="comment">// Email addresses (partial masking: j***@example.com)</span></div>
<div class="line">    ip_address,      <span class="comment">// IPv4 addresses (masks last 2 octets: 192.168.x.x)</span></div>
<div class="line">    phone_number,    <span class="comment">// Phone numbers (masks middle digits)</span></div>
<div class="line">    custom           <span class="comment">// User-defined patterns</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2645"></a>
API</h2>
<h3><a class="anchor" id="autotoc_md2646"></a>
Add Built-in Pattern</h3>
<div class="fragment"><div class="line">log_sanitizer&amp; log_sanitizer::add_pattern(sensitive_data_type type);</div>
</div><!-- fragment --><p><b>Returns:</b> Reference to <code>this</code> for method chaining</p>
<h3><a class="anchor" id="autotoc_md2647"></a>
Add Custom Pattern</h3>
<div class="fragment"><div class="line">log_sanitizer&amp; log_sanitizer::add_custom_pattern(</div>
<div class="line">    std::string_view name,</div>
<div class="line">    std::string_view regex_pattern,</div>
<div class="line">    std::string_view replacement = <span class="stringliteral">&quot;[REDACTED]&quot;</span>,</div>
<div class="line">    <span class="keywordtype">bool</span> preserve_partial = <span class="keyword">false</span></div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><code>name</code> — Identifier for the pattern (used for removal)</li>
<li><code>regex_pattern</code> — Regular expression to match sensitive data</li>
<li><code>replacement</code> — Replacement string (supports <code>$1</code>, <code>$2</code> for capture groups)</li>
<li><code>preserve_partial</code> — If <code>true</code>, preserve some characters (e.g., last 4 digits)</li>
</ul>
<h3><a class="anchor" id="autotoc_md2648"></a>
Remove Pattern</h3>
<div class="fragment"><div class="line">log_sanitizer&amp; log_sanitizer::remove_pattern(std::string_view name);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2649"></a>
Sanitize a String</h3>
<div class="fragment"><div class="line">std::string log_sanitizer::sanitize(std::string_view input) <span class="keyword">const</span>;</div>
</div><!-- fragment --><p><b>Returns:</b> Sanitized string with sensitive data masked</p>
<h3><a class="anchor" id="autotoc_md2650"></a>
Check for Sensitive Data</h3>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> log_sanitizer::contains_sensitive_data(std::string_view input) <span class="keyword">const</span>;</div>
</div><!-- fragment --><p><b>Returns:</b> <code>true</code> if any pattern matches, <code>false</code> otherwise</p>
<h3><a class="anchor" id="autotoc_md2651"></a>
Get Active Patterns</h3>
<div class="fragment"><div class="line">std::vector&lt;std::string&gt; log_sanitizer::active_patterns() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p><b>Returns:</b> List of currently active pattern names</p>
<h3><a class="anchor" id="autotoc_md2652"></a>
Add All Common Patterns</h3>
<div class="fragment"><div class="line">log_sanitizer&amp; log_sanitizer::add_common_patterns();</div>
</div><!-- fragment --><p><b>Adds:</b> <code>credit_card</code>, <code>ssn</code>, <code>api_key</code>, <code>password</code>, <code>email</code></p>
<h2><a class="anchor" id="autotoc_md2653"></a>
Example Usage</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/log_sanitizer.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Option 1: Use default sanitizer</span></div>
<div class="line"><span class="keyword">auto</span> sanitizer = make_default_sanitizer();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Option 2: Custom configuration</span></div>
<div class="line">log_sanitizer sanitizer;</div>
<div class="line">sanitizer.add_pattern(sensitive_data_type::credit_card)</div>
<div class="line">         .add_pattern(sensitive_data_type::email)</div>
<div class="line">         .add_pattern(sensitive_data_type::api_key);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add organization-specific pattern</span></div>
<div class="line">sanitizer.add_custom_pattern(</div>
<div class="line">    <span class="stringliteral">&quot;employee_id&quot;</span>,</div>
<div class="line">    R<span class="stringliteral">&quot;(\bEMP-\d{6}\b)&quot;,     </span><span class="comment">// Matches EMP-123456</span></div>
<div class="line">    <span class="stringliteral">&quot;EMP-******&quot;</span>,</div>
<div class="line">    <span class="keyword">false</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Sanitize log messages before writing</span></div>
<div class="line">std::string message = <span class="stringliteral">&quot;User john@example.com paid with card 4111-1111-1111-1111 using API key sk_live_abc123xyz&quot;</span>;</div>
<div class="line">std::string safe_message = sanitizer.sanitize(message);</div>
<div class="line"><span class="comment">// Result: &quot;User j***@example.com paid with card ****-****-****-1111 using API key sk_[REDACTED]&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check if a string contains sensitive data</span></div>
<div class="line"><span class="keywordflow">if</span> (sanitizer.contains_sensitive_data(user_input)) {</div>
<div class="line">    <span class="comment">// Log warning or reject input</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2654"></a>
Performance Impact</h2>
<ul>
<li><b>Regex matching</b> — O(n × m) where n = input length, m = number of patterns</li>
<li><b>Mitigation</b> — Use sanitizer selectively (e.g., only on user-facing logs)</li>
<li><b>Benchmark</b> — ~50-100 µs for typical log message with 5 patterns</li>
</ul>
<p><b>Optimization tips:</b></p><ul>
<li>Add only necessary patterns</li>
<li>Use <code>contains_sensitive_data()</code> for fast pre-check</li>
<li>Consider sampling (sanitize 1% of logs for monitoring)</li>
</ul>
<h2><a class="anchor" id="autotoc_md2655"></a>
Integration with Logger</h2>
<div class="fragment"><div class="line"><span class="comment">// Apply sanitization in formatter or writer</span></div>
<div class="line"><span class="keyword">class </span>sanitizing_writer {</div>
<div class="line">    log_sanitizer sanitizer_;</div>
<div class="line">    std::unique_ptr&lt;writer_interface&gt; inner_writer_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> write(<span class="keyword">const</span> log_message&amp; msg)<span class="keyword"> override </span>{</div>
<div class="line">        log_message safe_msg = msg;</div>
<div class="line">        safe_msg.text = sanitizer_.sanitize(msg.text);</div>
<div class="line">        inner_writer_-&gt;write(safe_msg);</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md2657"></a>
Path Validator</h1>
<p><b>Header:</b> <code>include/kcenon/logger/security/path_validator.h</code></p>
<h2><a class="anchor" id="autotoc_md2658"></a>
Purpose</h2>
<p>Prevents path traversal attacks (<code>../../../etc/passwd</code>) and validates file paths for secure log file creation.</p>
<h2><a class="anchor" id="autotoc_md2659"></a>
Key Features</h2>
<ul>
<li><b>Canonical path resolution</b> — Resolves <code>.</code> and <code>..</code> components</li>
<li><b>Directory enforcement</b> — Ensures paths stay within allowed base directory</li>
<li><b>Symlink validation</b> — Detects and optionally rejects symbolic links</li>
<li><b>Filename character restrictions</b> — Allows only alphanumeric + <code>-_.</code></li>
<li><b>Static utility functions</b> — Filename sanitization and safe path joining</li>
</ul>
<h2><a class="anchor" id="autotoc_md2660"></a>
Security Checks</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Check   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Configurable    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Path traversal (../)   </td><td class="markdownTableBodyNone">✅ Enabled   </td><td class="markdownTableBodyNone">❌ No    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Symlink detection   </td><td class="markdownTableBodyNone">✅ Enabled   </td><td class="markdownTableBodyNone">✅ Yes (<code>allow_symlinks</code>)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Filename characters   </td><td class="markdownTableBodyNone">✅ Enabled   </td><td class="markdownTableBodyNone">✅ Yes (<code>strict_filename</code>)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Base directory enforcement   </td><td class="markdownTableBodyNone">✅ Enabled   </td><td class="markdownTableBodyNone">❌ No   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md2661"></a>
API</h2>
<h3><a class="anchor" id="autotoc_md2662"></a>
Constructor</h3>
<div class="fragment"><div class="line"><span class="keyword">explicit</span> path_validator::path_validator(std::filesystem::path allowed_base);</div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><code>allowed_base</code> — All validated paths must be within this directory</li>
</ul>
<p><b>Behavior:</b></p><ul>
<li>Converts <code>allowed_base</code> to canonical form (if exists)</li>
<li>Uses <code>weakly_canonical</code> for non-existent paths</li>
</ul>
<h3><a class="anchor" id="autotoc_md2663"></a>
Validate Path</h3>
<div class="fragment"><div class="line">common::VoidResult path_validator::validate(</div>
<div class="line">    <span class="keyword">const</span> std::filesystem::path&amp; path,</div>
<div class="line">    <span class="keywordtype">bool</span> allow_symlinks = <span class="keyword">false</span>,</div>
<div class="line">    <span class="keywordtype">bool</span> strict_filename = <span class="keyword">true</span></div>
<div class="line">) <span class="keyword">const</span>;</div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><code>path</code> — Path to validate</li>
<li><code>allow_symlinks</code> — If <code>false</code>, reject symbolic links</li>
<li><code>strict_filename</code> — If <code>true</code>, enforce alphanumeric + <code>-_.</code> restriction</li>
</ul>
<p><b>Returns:</b> <code>ok()</code> on success, <code>err(...)</code> with error code/message on failure</p>
<p><b>Error codes:</b></p><ul>
<li><code>logger_error_code::path_traversal_detected</code> — Path escapes allowed base</li>
<li><code>logger_error_code::invalid_filename</code> — Filename contains dangerous characters</li>
</ul>
<h3><a class="anchor" id="autotoc_md2664"></a>
Static: Check Filename Safety</h3>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> path_validator::is_safe_filename(<span class="keyword">const</span> std::string&amp; name);</div>
</div><!-- fragment --><p><b>Allowed characters:</b> <code>a-z</code>, <code>A-Z</code>, <code>0-9</code>, <code>-</code>, <code>_</code>, <code>.</code></p>
<p><b>Returns:</b> <code>false</code> for empty string, <code>.</code>, <code>..</code>, or any invalid character</p>
<h3><a class="anchor" id="autotoc_md2665"></a>
Static: Sanitize Filename</h3>
<div class="fragment"><div class="line"><span class="keyword">static</span> std::string path_validator::sanitize_filename(</div>
<div class="line">    <span class="keyword">const</span> std::string&amp; name,</div>
<div class="line">    <span class="keywordtype">char</span> replacement = <span class="charliteral">&#39;_&#39;</span></div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Behavior:</b></p><ul>
<li>Replaces invalid characters with <code>replacement</code> (default: <code>_</code>)</li>
<li>Handles special cases (<code>.</code> → <code>_.</code>, <code>..</code> → <code>_..</code>, empty → <code>"unnamed"</code>)</li>
</ul>
<h3><a class="anchor" id="autotoc_md2666"></a>
Static: Safe Path Join</h3>
<div class="fragment"><div class="line"><span class="keyword">static</span> result&lt;std::filesystem::path&gt; path_validator::safe_join(</div>
<div class="line">    <span class="keyword">const</span> std::filesystem::path&amp; base,</div>
<div class="line">    <span class="keyword">const</span> std::filesystem::path&amp; relative</div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><code>base</code> — Base directory</li>
<li><code>relative</code> — Relative path to join (must not be absolute)</li>
</ul>
<p><b>Returns:</b> <code>ok(joined_path)</code> or <code>err(...)</code> if validation fails</p>
<p><b>Security:</b> Validates the joined path using <code>path_validator(base)</code></p>
<h2><a class="anchor" id="autotoc_md2667"></a>
Example Usage</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/path_validator.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create validator for log directory</span></div>
<div class="line">path_validator validator(<span class="stringliteral">&quot;/var/log/myapp&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Validate user-provided log file path</span></div>
<div class="line">std::string user_input = <span class="stringliteral">&quot;../../../etc/passwd&quot;</span>;  <span class="comment">// Attack attempt</span></div>
<div class="line"><span class="keyword">auto</span> result = validator.validate(user_input);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (result.is_err()) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Invalid path: &quot;</span> &lt;&lt; get_logger_error_message(result) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <span class="comment">// Output: &quot;Invalid path: Path must be within allowed directory: /var/log/myapp&quot;</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Safe path joining</span></div>
<div class="line"><span class="keyword">auto</span> safe_path = path_validator::safe_join(</div>
<div class="line">    <span class="stringliteral">&quot;/var/log/myapp&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;2025-02-09/server.log&quot;</span>  <span class="comment">// OK</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> unsafe_path = path_validator::safe_join(</div>
<div class="line">    <span class="stringliteral">&quot;/var/log/myapp&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;/etc/passwd&quot;</span>  <span class="comment">// Rejected: absolute path</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Sanitize user-provided filename</span></div>
<div class="line">std::string unsafe_name = <span class="stringliteral">&quot;my log!@#$%file.txt&quot;</span>;</div>
<div class="line">std::string safe_name = path_validator::sanitize_filename(unsafe_name);</div>
<div class="line"><span class="comment">// Result: &quot;my_log_____file.txt&quot;</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2668"></a>
Integration with Writers</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>validated_file_writer : <span class="keyword">public</span> writer_interface {</div>
<div class="line">    path_validator validator_;</div>
<div class="line">    std::filesystem::path current_path_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> validated_file_writer(std::filesystem::path base_dir)</div>
<div class="line">        : validator_(std::move(base_dir)) {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> set_file_path(<span class="keyword">const</span> std::filesystem::path&amp; path) {</div>
<div class="line">        <span class="keyword">auto</span> result = validator_.validate(path, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (result.is_err()) {</div>
<div class="line">            <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Invalid log file path: &quot;</span> +</div>
<div class="line">                                     get_logger_error_message(result));</div>
<div class="line">        }</div>
<div class="line">        current_path_ = path;</div>
<div class="line">        <span class="comment">// Open file...</span></div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md2670"></a>
Secure Key Storage</h1>
<p><b>Header:</b> <code>include/kcenon/logger/security/secure_key_storage.h</code></p>
<h2><a class="anchor" id="autotoc_md2671"></a>
Purpose</h2>
<p>Securely generates, stores, and retrieves encryption keys with automatic memory cleanup and permission enforcement.</p>
<h2><a class="anchor" id="autotoc_md2672"></a>
Key Features</h2>
<ul>
<li><b>Secure random generation</b> — OpenSSL <code>RAND_bytes()</code> (or <code>std::random_device</code> fallback)</li>
<li><b>RAII memory management</b> — Automatic zeroing on destruction</li>
<li><b>Move-only semantics</b> — Prevents accidental key copies</li>
<li><b>File permission enforcement</b> — Keys saved with 0600 (owner read/write only)</li>
<li><b>Path traversal prevention</b> — Uses <code>path_validator</code> internally</li>
<li><b>OpenSSL support</b> — Uses <code>OPENSSL_cleanse()</code> for secure memory wiping</li>
</ul>
<h2><a class="anchor" id="autotoc_md2673"></a>
Classes</h2>
<h3><a class="anchor" id="autotoc_md2674"></a>
&lt;tt&gt;secure_key&lt;/tt&gt;</h3>
<p>RAII wrapper for encryption keys with secure memory cleanup.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>secure_key {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> secure_key(<span class="keywordtype">size_t</span> size);               <span class="comment">// Create empty key</span></div>
<div class="line">    <span class="keyword">explicit</span> secure_key(std::vector&lt;uint8_t&gt; data); <span class="comment">// Create from data</span></div>
<div class="line">    ~secure_key();                                  <span class="comment">// Securely clears memory</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;uint8_t&gt;&amp; data() <span class="keyword">const</span>;       <span class="comment">// Read-only access</span></div>
<div class="line">    std::vector&lt;uint8_t&gt;&amp; mutable_data();           <span class="comment">// Mutable access (use with caution)</span></div>
<div class="line">    <span class="keywordtype">size_t</span> size() <span class="keyword">const</span>;                            <span class="comment">// Key size in bytes</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Move-only (no copying)</span></div>
<div class="line">    secure_key(<span class="keyword">const</span> secure_key&amp;) = <span class="keyword">delete</span>;</div>
<div class="line">    secure_key&amp; operator=(<span class="keyword">const</span> secure_key&amp;) = <span class="keyword">delete</span>;</div>
<div class="line">    secure_key(secure_key&amp;&amp;) noexcept;</div>
<div class="line">    secure_key&amp; operator=(secure_key&amp;&amp;) noexcept;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Memory cleanup:</b></p><ul>
<li>OpenSSL available: <code>OPENSSL_cleanse(data, size)</code></li>
<li>Fallback: Volatile pointer zeroing (prevents compiler optimization)</li>
</ul>
<h3><a class="anchor" id="autotoc_md2675"></a>
&lt;tt&gt;secure_key_storage&lt;/tt&gt;</h3>
<p>Static utility class for key lifecycle management.</p>
<h2><a class="anchor" id="autotoc_md2676"></a>
API</h2>
<h3><a class="anchor" id="autotoc_md2677"></a>
Generate Secure Random Key</h3>
<div class="fragment"><div class="line"><span class="keyword">static</span> result&lt;secure_key&gt; secure_key_storage::generate_key(<span class="keywordtype">size_t</span> size = 32);</div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><code>size</code> — Key size in bytes (default: 32 for AES-256)</li>
</ul>
<p><b>Returns:</b> <code>ok(secure_key)</code> or <code>err(encryption_failed)</code> if random generation fails</p>
<p><b>Randomness source:</b></p><ul>
<li>OpenSSL available: <code>RAND_bytes()</code> (cryptographically secure)</li>
<li>Fallback: <code>std::random_device</code> (platform-dependent quality)</li>
</ul>
<h3><a class="anchor" id="autotoc_md2678"></a>
Save Key to File</h3>
<div class="fragment"><div class="line"><span class="keyword">static</span> common::VoidResult secure_key_storage::save_key(</div>
<div class="line">    <span class="keyword">const</span> secure_key&amp; key,</div>
<div class="line">    <span class="keyword">const</span> std::filesystem::path&amp; path,</div>
<div class="line">    <span class="keyword">const</span> std::filesystem::path&amp; allowed_base = <span class="stringliteral">&quot;/var/log/keys&quot;</span></div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><code>key</code> — Key to save</li>
<li><code>path</code> — File path (must be within <code>allowed_base</code>)</li>
<li><code>allowed_base</code> — Base directory for key storage (default: <code>/var/log/keys</code>)</li>
</ul>
<p><b>Security:</b></p><ul>
<li>Validates path (prevents traversal)</li>
<li>Creates parent directory if needed</li>
<li>Sets file permissions to 0600 (owner read/write only)</li>
<li>Deletes file if permission setting fails (fail-secure)</li>
</ul>
<p><b>Returns:</b> <code>ok()</code> on success, <code>err(...)</code> on failure</p>
<p><b>Error codes:</b></p><ul>
<li><code>path_traversal_detected</code> — Path escapes <code>allowed_base</code></li>
<li><code>file_write_failed</code> — Failed to write key data</li>
<li><code>file_permission_denied</code> — Failed to set secure permissions</li>
</ul>
<h3><a class="anchor" id="autotoc_md2679"></a>
Load Key from File</h3>
<div class="fragment"><div class="line"><span class="keyword">static</span> result&lt;secure_key&gt; secure_key_storage::load_key(</div>
<div class="line">    <span class="keyword">const</span> std::filesystem::path&amp; path,</div>
<div class="line">    <span class="keywordtype">size_t</span> expected_size = 32,</div>
<div class="line">    <span class="keyword">const</span> std::filesystem::path&amp; allowed_base = <span class="stringliteral">&quot;/var/log/keys&quot;</span></div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><code>path</code> — File path</li>
<li><code>expected_size</code> — Expected key size (default: 32 for AES-256)</li>
<li><code>allowed_base</code> — Base directory for key storage</li>
</ul>
<p><b>Security checks:</b></p><ol type="1">
<li>Path validation (traversal prevention)</li>
<li>File existence check</li>
<li><b>Permission verification</b> — Rejects files readable by group/others</li>
<li>File size verification (must match <code>expected_size</code>)</li>
<li>Key data read</li>
</ol>
<p><b>Returns:</b> <code>ok(secure_key)</code> or <code>err(...)</code></p>
<p><b>Error codes:</b></p><ul>
<li><code>path_traversal_detected</code> — Invalid path</li>
<li><code>file_open_failed</code> — File doesn't exist</li>
<li><code>insecure_permissions</code> — File permissions too permissive (not 0600)</li>
<li><code>invalid_key_size</code> — File size mismatch</li>
<li><code>file_read_failed</code> — Read error</li>
</ul>
<h2><a class="anchor" id="autotoc_md2680"></a>
Example Usage</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/secure_key_storage.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Generate a new AES-256 key</span></div>
<div class="line"><span class="keyword">auto</span> key_result = secure_key_storage::generate_key(32);</div>
<div class="line"><span class="keywordflow">if</span> (key_result.is_err()) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to generate key: &quot;</span></div>
<div class="line">              &lt;&lt; get_logger_error_message(key_result) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">secure_key master_key = std::move(key_result).unwrap();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Save key to file (0600 permissions)</span></div>
<div class="line"><span class="keyword">auto</span> save_result = secure_key_storage::save_key(</div>
<div class="line">    master_key,</div>
<div class="line">    <span class="stringliteral">&quot;/var/log/keys/master.key&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;/var/log/keys&quot;</span>  <span class="comment">// allowed base directory</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (save_result.is_err()) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to save key: &quot;</span></div>
<div class="line">              &lt;&lt; get_logger_error_message(save_result) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Later: Load key from file</span></div>
<div class="line"><span class="keyword">auto</span> load_result = secure_key_storage::load_key(</div>
<div class="line">    <span class="stringliteral">&quot;/var/log/keys/master.key&quot;</span>,</div>
<div class="line">    32,  <span class="comment">// expected size</span></div>
<div class="line">    <span class="stringliteral">&quot;/var/log/keys&quot;</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (load_result.is_err()) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to load key: &quot;</span></div>
<div class="line">              &lt;&lt; get_logger_error_message(load_result) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">secure_key loaded_key = std::move(load_result).unwrap();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Key is automatically zeroed when `loaded_key` goes out of scope</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2681"></a>
Key Rotation</h2>
<div class="fragment"><div class="line"><span class="comment">// Generate new key</span></div>
<div class="line"><span class="keyword">auto</span> new_key = secure_key_storage::generate_key(32).unwrap();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Save with timestamp suffix</span></div>
<div class="line">std::string key_path = <span class="stringliteral">&quot;/var/log/keys/master-&quot;</span> +</div>
<div class="line">                       std::to_string(std::time(<span class="keyword">nullptr</span>)) + <span class="stringliteral">&quot;.key&quot;</span>;</div>
<div class="line">secure_key_storage::save_key(new_key, key_path);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Log audit event</span></div>
<div class="line">audit_logger::log_audit_event(</div>
<div class="line">    audit_event::encryption_key_rotated,</div>
<div class="line">    <span class="stringliteral">&quot;Rotated master encryption key&quot;</span>,</div>
<div class="line">    {{<span class="stringliteral">&quot;old_key&quot;</span>, <span class="stringliteral">&quot;master-1707491245.key&quot;</span>}, {<span class="stringliteral">&quot;new_key&quot;</span>, key_path}}</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Archive old key (or delete after re-encrypting data)</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2682"></a>
Platform-Specific Considerations</h2>
<h3><a class="anchor" id="autotoc_md2683"></a>
Linux/macOS</h3>
<ul>
<li>Uses OpenSSL for secure random generation and memory cleanup</li>
<li>File permissions enforced via <code>chmod 600</code></li>
<li>Consider using kernel keyring (<code>keyctl</code>) for production</li>
</ul>
<h3><a class="anchor" id="autotoc_md2684"></a>
Windows</h3>
<ul>
<li>Uses OpenSSL or <code>std::random_device</code> (backed by <code>CryptGenRandom</code>)</li>
<li>File permissions less granular (ACLs recommended)</li>
<li>Consider using DPAPI (<code>CryptProtectData</code>) for production</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md2686"></a>
Signal Manager</h1>
<p><b>Header:</b> <code>include/kcenon/logger/security/signal_manager.h</code></p>
<p><b>Interface:</b> <code>include/kcenon/logger/security/signal_manager_interface.h</code></p>
<h2><a class="anchor" id="autotoc_md2687"></a>
Purpose</h2>
<p>Ensures graceful shutdown and emergency log flushing when process receives fatal signals (SIGSEGV, SIGABRT, SIGTERM, SIGINT).</p>
<h2><a class="anchor" id="autotoc_md2688"></a>
Key Features</h2>
<ul>
<li><b>Signal-safe implementation</b> — Uses only signal-safe functions in handlers</li>
<li><b>Cross-platform</b> — Works on POSIX (Linux, macOS) and Windows</li>
<li><b>Centralized management</b> — Prevents conflicts when multiple loggers exist</li>
<li><b>Dependency injection</b> — Implements <code>signal_manager_interface</code> for testing</li>
<li><b>Emergency flush</b> — Flushes buffered logs using raw <code>write()</code> and <code>fsync()</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md2689"></a>
Handled Signals</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Signal   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Behavior    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>SIGSEGV</code>   </td><td class="markdownTableBodyNone">Segmentation fault (crash)   </td><td class="markdownTableBodyNone">Emergency flush → call original handler → abort    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>SIGABRT</code>   </td><td class="markdownTableBodyNone">Abort signal (assert failure)   </td><td class="markdownTableBodyNone">Emergency flush → call original handler → abort    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>SIGTERM</code>   </td><td class="markdownTableBodyNone">Termination request (graceful shutdown)   </td><td class="markdownTableBodyNone">Emergency flush → call original handler → exit    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>SIGINT</code>   </td><td class="markdownTableBodyNone">Interrupt (Ctrl+C)   </td><td class="markdownTableBodyNone">Emergency flush → call original handler → exit   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md2690"></a>
Signal-Safe Guarantees</h2>
<p><b>Functions allowed in signal handlers (POSIX):</b></p><ul>
<li>✅ <code>write()</code>, <code>fsync()</code>, <code>_exit()</code></li>
<li>✅ Most syscalls (file I/O, process control)</li>
</ul>
<p><b>Functions NOT allowed (undefined behavior):</b></p><ul>
<li>❌ <code>malloc()</code>, <code>free()</code>, <code>new</code>, <code>delete</code></li>
<li>❌ <code>printf()</code>, <code>std::cout</code>, <code>std::cerr</code> (not signal-safe)</li>
<li>❌ <code>std::mutex::lock()</code> (may deadlock)</li>
</ul>
<p><b>Implementation:</b> <code>signal_manager</code> uses only signal-safe functions in handlers.</p>
<h2><a class="anchor" id="autotoc_md2691"></a>
API</h2>
<h3><a class="anchor" id="autotoc_md2692"></a>
Register Logger</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> signal_manager::register_logger(critical_logger_interface* log) <span class="keyword">override</span>;</div>
</div><!-- fragment --><p><b>Behavior:</b></p><ul>
<li>Adds logger to the set of loggers to flush on signal</li>
<li>Installs signal handlers when first logger is registered</li>
<li>Thread-safe (uses <code>std::mutex</code> outside of signal handler)</li>
</ul>
<h3><a class="anchor" id="autotoc_md2693"></a>
Unregister Logger</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> signal_manager::unregister_logger(critical_logger_interface* log) <span class="keyword">override</span>;</div>
</div><!-- fragment --><p><b>Behavior:</b></p><ul>
<li>Removes logger from the set</li>
<li>Uninstalls signal handlers when last logger is unregistered</li>
</ul>
<h3><a class="anchor" id="autotoc_md2694"></a>
Check Handler Installation</h3>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> signal_manager::are_handlers_installed() <span class="keyword">const override</span>;</div>
</div><!-- fragment --><p><b>Returns:</b> <code>true</code> if signal handlers are currently installed</p>
<h3><a class="anchor" id="autotoc_md2695"></a>
Get Logger Count</h3>
<div class="fragment"><div class="line"><span class="keywordtype">size_t</span> signal_manager::logger_count() <span class="keyword">const override</span>;</div>
</div><!-- fragment --><p><b>Returns:</b> Number of registered loggers</p>
<h2><a class="anchor" id="autotoc_md2696"></a>
Critical Logger Interface</h2>
<p>Loggers that support emergency flushing must implement:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>critical_logger_interface {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> ~critical_logger_interface() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get file descriptor for emergency writing</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> get_emergency_fd() <span class="keyword">const</span> = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get emergency buffer pointer</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_emergency_buffer() <span class="keyword">const</span> = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get emergency buffer size</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">size_t</span> get_emergency_buffer_size() <span class="keyword">const</span> = 0;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Requirements:</b></p><ul>
<li>All methods must be <b>signal-safe</b> (no allocations, no locks)</li>
<li>File descriptor must be valid (&gt;= 0)</li>
<li>Buffer must be pre-allocated (no dynamic allocation in handler)</li>
</ul>
<h2><a class="anchor" id="autotoc_md2697"></a>
Example Usage</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/signal_manager.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Logger implementation with emergency flush support</span></div>
<div class="line"><span class="keyword">class </span>my_logger : <span class="keyword">public</span> critical_logger_interface {</div>
<div class="line">    <span class="keywordtype">int</span> fd_ = -1;</div>
<div class="line">    std::array&lt;char, 4096&gt; emergency_buffer_;</div>
<div class="line">    <span class="keywordtype">size_t</span> buffer_pos_ = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">int</span> get_emergency_fd()<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> fd_;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* get_emergency_buffer()<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> emergency_buffer_.data();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> get_emergency_buffer_size()<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> buffer_pos_;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> write_log(<span class="keyword">const</span> std::string&amp; message) {</div>
<div class="line">        <span class="comment">// Normal logging (buffered)</span></div>
<div class="line">        <span class="keywordflow">if</span> (buffer_pos_ + message.size() &lt; emergency_buffer_.size()) {</div>
<div class="line">            std::memcpy(emergency_buffer_.data() + buffer_pos_,</div>
<div class="line">                        message.data(), message.size());</div>
<div class="line">            buffer_pos_ += message.size();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Register logger with signal manager</span></div>
<div class="line">signal_manager sig_mgr;</div>
<div class="line">my_logger logger;</div>
<div class="line"> </div>
<div class="line">sig_mgr.register_logger(&amp;logger);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Now, if SIGSEGV/SIGABRT/SIGTERM/SIGINT is received:</span></div>
<div class="line"><span class="comment">// 1. Emergency flush writes buffer to disk using write() + fsync()</span></div>
<div class="line"><span class="comment">// 2. Original signal handler is called (or process terminates)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Cleanup</span></div>
<div class="line">sig_mgr.unregister_logger(&amp;logger);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2698"></a>
Emergency Flush Implementation</h2>
<div class="fragment"><div class="line"><span class="comment">// Signal handler (in signal_manager.h)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> signal_handler(<span class="keywordtype">int</span> sig) {</div>
<div class="line">    <span class="comment">// Write signal message to stderr (signal-safe)</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* msg = <span class="stringliteral">&quot;\n[CRITICAL] SIGSEGV received - emergency flush\n&quot;</span>;</div>
<div class="line">    write(STDERR_FILENO, msg, 45);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Flush all registered loggers</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>* log : loggers_) {</div>
<div class="line">        <span class="keywordtype">int</span> fd = log-&gt;get_emergency_fd();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* buffer = log-&gt;get_emergency_buffer();</div>
<div class="line">        <span class="keywordtype">size_t</span> size = log-&gt;get_emergency_buffer_size();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Write using signal-safe write() syscall</span></div>
<div class="line">        ssize_t written = 0;</div>
<div class="line">        <span class="keywordflow">while</span> (written &lt; size) {</div>
<div class="line">            ssize_t n = write(fd, buffer + written, size - written);</div>
<div class="line">            <span class="keywordflow">if</span> (n &lt;= 0) <span class="keywordflow">break</span>;</div>
<div class="line">            written += n;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Sync to disk (signal-safe)</span></div>
<div class="line">        fsync(fd);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Call original handler or terminate</span></div>
<div class="line">    _exit(128 + sig);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2699"></a>
Testing Considerations</h2>
<p>Use <code>signal_manager_interface</code> for dependency injection:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>mock_signal_manager : <span class="keyword">public</span> signal_manager_interface {</div>
<div class="line">    std::vector&lt;critical_logger_interface*&gt; loggers_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> register_logger(critical_logger_interface* log)<span class="keyword"> override </span>{</div>
<div class="line">        loggers_.push_back(log);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> unregister_logger(critical_logger_interface* log)<span class="keyword"> override </span>{</div>
<div class="line">        loggers_.erase(std::remove(loggers_.begin(), loggers_.end(), log),</div>
<div class="line">                       loggers_.end());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> are_handlers_installed()<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> !loggers_.empty();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> logger_count()<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> loggers_.size();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Test-only: Simulate signal</span></div>
<div class="line">    <span class="keywordtype">void</span> simulate_signal(<span class="keywordtype">int</span> sig) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span>* log : loggers_) {</div>
<div class="line">            <span class="comment">// Call emergency flush logic</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md2701"></a>
Configuration Examples</h1>
<h2><a class="anchor" id="autotoc_md2702"></a>
Minimal Security Setup</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/log_sanitizer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/path_validator.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create logger with basic security</span></div>
<div class="line"><span class="keyword">auto</span> logger = logger_builder::create()</div>
<div class="line">    .with_path_validator(<span class="stringliteral">&quot;/var/log/myapp&quot;</span>)</div>
<div class="line">    .with_sanitizer(make_default_sanitizer())</div>
<div class="line">    .with_console_writer()</div>
<div class="line">    .with_file_writer(<span class="stringliteral">&quot;/var/log/myapp/app.log&quot;</span>)</div>
<div class="line">    .build();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2703"></a>
High-Security Setup (Compliance)</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/audit_logger.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/log_sanitizer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/path_validator.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/secure_key_storage.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/security/signal_manager.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// 1. Generate and save HMAC key for audit log</span></div>
<div class="line"><span class="keyword">auto</span> hmac_key = secure_key_storage::generate_key(32).unwrap();</div>
<div class="line">secure_key_storage::save_key(hmac_key, <span class="stringliteral">&quot;/var/log/keys/audit_hmac.key&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 2. Initialize audit logger</span></div>
<div class="line">audit_logger::initialize(<span class="stringliteral">&quot;/var/log/audit/security.log&quot;</span>, &amp;hmac_key);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 3. Configure sanitizer</span></div>
<div class="line">log_sanitizer sanitizer;</div>
<div class="line">sanitizer.add_common_patterns()</div>
<div class="line">         .add_custom_pattern(<span class="stringliteral">&quot;account_number&quot;</span>, R<span class="stringliteral">&quot;(\b\d{10,12}\b)&quot;, </span><span class="stringliteral">&quot;[ACCT]&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 4. Create logger with all security features</span></div>
<div class="line"><span class="keyword">auto</span> logger = logger_builder::create()</div>
<div class="line">    .with_path_validator(<span class="stringliteral">&quot;/var/log/myapp&quot;</span>)</div>
<div class="line">    .with_sanitizer(std::move(sanitizer))</div>
<div class="line">    .with_encrypted_writer(<span class="stringliteral">&quot;/var/log/myapp/encrypted.log&quot;</span>)  <span class="comment">// See ENCRYPTION.md</span></div>
<div class="line">    .build();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 5. Register signal handler for emergency flush</span></div>
<div class="line">signal_manager sig_mgr;</div>
<div class="line">sig_mgr.register_logger(logger.get());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 6. Log audit events</span></div>
<div class="line">audit_logger::log_audit_event(</div>
<div class="line">    audit_event::logger_started,</div>
<div class="line">    <span class="stringliteral">&quot;Application logging initialized&quot;</span>,</div>
<div class="line">    {{<span class="stringliteral">&quot;version&quot;</span>, <span class="stringliteral">&quot;2.0.0&quot;</span>}, {<span class="stringliteral">&quot;security_level&quot;</span>, <span class="stringliteral">&quot;high&quot;</span>}}</div>
<div class="line">);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2704"></a>
Custom Security Layer</h2>
<div class="fragment"><div class="line"><span class="comment">// Wrap writer with sanitization</span></div>
<div class="line"><span class="keyword">class </span>sanitizing_writer : <span class="keyword">public</span> writer_interface {</div>
<div class="line">    log_sanitizer sanitizer_;</div>
<div class="line">    std::unique_ptr&lt;writer_interface&gt; inner_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    sanitizing_writer(log_sanitizer sanitizer, std::unique_ptr&lt;writer_interface&gt; inner)</div>
<div class="line">        : sanitizer_(std::move(sanitizer)), inner_(std::move(inner)) {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> write(<span class="keyword">const</span> log_message&amp; msg)<span class="keyword"> override </span>{</div>
<div class="line">        log_message safe_msg = msg;</div>
<div class="line">        safe_msg.text = sanitizer_.sanitize(msg.text);</div>
<div class="line">        inner_-&gt;write(safe_msg);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Usage</span></div>
<div class="line"><span class="keyword">auto</span> writer = std::make_unique&lt;sanitizing_writer&gt;(</div>
<div class="line">    make_default_sanitizer(),</div>
<div class="line">    std::make_unique&lt;file_writer&gt;(<span class="stringliteral">&quot;/var/log/app.log&quot;</span>)</div>
<div class="line">);</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md2706"></a>
Compliance Considerations</h1>
<h2><a class="anchor" id="autotoc_md2707"></a>
SOX (Sarbanes-Oxley)</h2>
<p><b>Requirements:</b></p><ul>
<li>Audit trail for financial system access</li>
<li>Tamper-evident logs</li>
<li>Access control for log files</li>
</ul>
<p><b>Implementation:</b></p><ul>
<li>Use <code>audit_logger</code> with HMAC signatures</li>
<li>Log all authentication events (<code>authentication_success</code>, <code>authentication_failure</code>)</li>
<li>Store audit logs with 0600 permissions</li>
<li>Verify signatures periodically</li>
</ul>
<p><b>Retention:</b> Typically 7 years for financial records</p>
<h2><a class="anchor" id="autotoc_md2708"></a>
HIPAA (Health Insurance Portability and Accountability Act)</h2>
<p><b>Requirements:</b></p><ul>
<li>Audit trail for PHI (Protected Health Information) access</li>
<li>PII masking in non-audit logs</li>
<li>Secure storage and transmission</li>
</ul>
<p><b>Implementation:</b></p><ul>
<li>Use <code>log_sanitizer</code> for application logs (mask SSN, email, phone)</li>
<li>Use <code>audit_logger</code> for access logs (who accessed what PHI, when)</li>
<li>Encrypt audit logs with <code>encrypted_writer</code></li>
</ul>
<p><b>Retention:</b> Minimum 6 years</p>
<h2><a class="anchor" id="autotoc_md2709"></a>
GDPR (General Data Protection Regulation)</h2>
<p><b>Requirements:</b></p><ul>
<li>Data processing activity logs</li>
<li>PII masking or pseudonymization</li>
<li>Right to erasure (log retention limits)</li>
</ul>
<p><b>Implementation:</b></p><ul>
<li>Use <code>log_sanitizer</code> to mask email, IP address, phone numbers</li>
<li>Log data processing events: <div class="fragment"><div class="line">audit_logger::log_audit_event(</div>
<div class="line">    audit_event::configuration_changed,</div>
<div class="line">    <span class="stringliteral">&quot;User updated privacy settings&quot;</span>,</div>
<div class="line">    {{<span class="stringliteral">&quot;user_id&quot;</span>, <span class="stringliteral">&quot;12345&quot;</span>}, {<span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;opt_out_marketing&quot;</span>}}</div>
<div class="line">);</div>
</div><!-- fragment --></li>
<li>Implement log rotation and deletion after retention period</li>
</ul>
<p><b>Retention:</b> Varies by purpose (typically 1-3 years)</p>
<h2><a class="anchor" id="autotoc_md2710"></a>
PCI-DSS (Payment Card Industry Data Security Standard)</h2>
<p><b>Requirements:</b></p><ul>
<li>Requirement 10.x: Track and monitor all access to network resources and cardholder data</li>
<li>Mask PAN (Primary Account Number) in logs</li>
<li>Secure audit log storage</li>
</ul>
<p><b>Implementation:</b></p><ul>
<li>Use <code>log_sanitizer</code> with <code>credit_card</code> pattern (masks all but last 4 digits)</li>
<li>Use <code>audit_logger</code> for access events: <div class="fragment"><div class="line">audit_logger::log_audit_event(</div>
<div class="line">    audit_event::file_access_granted,</div>
<div class="line">    <span class="stringliteral">&quot;User accessed payment processing module&quot;</span>,</div>
<div class="line">    {{<span class="stringliteral">&quot;user&quot;</span>, <span class="stringliteral">&quot;admin&quot;</span>}, {<span class="stringliteral">&quot;resource&quot;</span>, <span class="stringliteral">&quot;payment_gateway&quot;</span>}}</div>
<div class="line">);</div>
</div><!-- fragment --></li>
<li>Store audit logs on separate server (or encrypted partition)</li>
</ul>
<p><b>Retention:</b> Minimum 1 year, 3 months online</p>
<h2><a class="anchor" id="autotoc_md2711"></a>
ISO 27001 (Information Security Management)</h2>
<p><b>Requirements:</b></p><ul>
<li>Security event logging</li>
<li>Log integrity protection</li>
<li>Access control</li>
</ul>
<p><b>Implementation:</b></p><ul>
<li>Use all security components (audit, sanitizer, path validator, key storage)</li>
<li>Implement log monitoring and alerting</li>
<li>Document security procedures in ISMS</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md2713"></a>
Frequently Asked Questions</h1>
<h2><a class="anchor" id="autotoc_md2714"></a>
Q: Can I use the security module without OpenSSL?</h2>
<p><b>A:</b> Yes, but with reduced security:</p><ul>
<li><b>Audit logger:</b> Falls back to simple hash (not cryptographically secure)</li>
<li><b>Secure key storage:</b> Falls back to <code>std::random_device</code> (platform-dependent quality)</li>
</ul>
<p><b>Recommendation:</b> Build with OpenSSL for production use.</p>
<h2><a class="anchor" id="autotoc_md2715"></a>
Q: How do I rotate encryption keys?</h2>
<p><b>A:</b> See Key Rotation section. Recommended frequency: Every 90 days (or per compliance requirements).</p>
<h2><a class="anchor" id="autotoc_md2716"></a>
Q: What's the performance overhead of log sanitization?</h2>
<p><b>A:</b> ~50-100 µs per message (5 patterns). Use selectively or sample logs (e.g., 1% of traffic).</p>
<h2><a class="anchor" id="autotoc_md2717"></a>
Q: How do I verify audit log integrity?</h2>
<p><b>A:</b> Read the audit log file and verify each entry:</p>
<div class="fragment"><div class="line">std::ifstream audit_file(<span class="stringliteral">&quot;/var/log/audit/security.log&quot;</span>);</div>
<div class="line">std::string json_entry, signature_line;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (std::getline(audit_file, json_entry)) {</div>
<div class="line">    <span class="keywordflow">if</span> (std::getline(audit_file, signature_line)) {</div>
<div class="line">        <span class="comment">// Extract signature from &quot;SIGNATURE:abc123...&quot;</span></div>
<div class="line">        std::string signature = signature_line.substr(10);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!audit_logger::verify_entry(json_entry, signature)) {</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;TAMPERING DETECTED: &quot;</span> &lt;&lt; json_entry &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2718"></a>
Q: Can I use multiple loggers with one signal manager?</h2>
<p><b>A:</b> Yes. <code>signal_manager</code> maintains a set of all registered loggers and flushes all of them on signal.</p>
<h2><a class="anchor" id="autotoc_md2719"></a>
Q: How do I handle signal manager cleanup?</h2>
<p><b>A:</b> Unregister loggers before destroying them:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    signal_manager sig_mgr;</div>
<div class="line">    my_logger logger;</div>
<div class="line"> </div>
<div class="line">    sig_mgr.register_logger(&amp;logger);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Use logger...</span></div>
<div class="line"> </div>
<div class="line">    sig_mgr.unregister_logger(&amp;logger);  <span class="comment">// Unregister before logger destructor</span></div>
<div class="line">}</div>
<div class="line"><span class="comment">// sig_mgr destructor automatically uninstalls signal handlers</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md2721"></a>
Summary</h1>
<p>The <b>logger_system security module</b> provides enterprise-grade protection for logging infrastructure:</p>
<ul>
<li>✅ <b>Tamper detection</b> — HMAC-signed audit logs</li>
<li>✅ <b>Data privacy</b> — PII/sensitive data masking</li>
<li>✅ <b>Path security</b> — Traversal attack prevention</li>
<li>✅ <b>Key management</b> — Secure generation and storage</li>
<li>✅ <b>Graceful shutdown</b> — Signal-safe emergency flush</li>
<li>✅ <b>Compliance ready</b> — SOX, HIPAA, GDPR, PCI-DSS support</li>
</ul>
<p><b>Next steps:</b></p><ul>
<li>Review ENCRYPTION.md for encrypted log storage</li>
<li>Review <a class="el" href="md__2home_2runner_2work_2logger__system_2logger__system_2docs_2ARCHITECTURE.html">ARCHITECTURE.md</a> for module integration</li>
<li>Configure security features in <code>logger_builder</code></li>
</ul>
<p><b>Related documentation:</b></p><ul>
<li>ENCRYPTION.md — Encrypted log file storage</li>
<li>API.md — Full API reference</li>
<li>EXAMPLES.md — Usage examples</li>
</ul>
<hr  />
<p><em>Last updated: 2025-02-09</em> <em>logger_system version: 2.x</em> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Feb 11 2026 23:47:05 for Logger System by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
