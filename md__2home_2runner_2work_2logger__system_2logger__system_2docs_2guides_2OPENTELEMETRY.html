<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Logger System: OpenTelemetry Integration Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Logger System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-performance C++20 thread-safe logging system with asynchronous capabilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__2home_2runner_2work_2logger__system_2logger__system_2docs_2guides_2OPENTELEMETRY.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">OpenTelemetry Integration Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1500"></a> </p><blockquote class="doxtable">
<p>&zwj;<b>Version</b>: 3.0.0+ <b>Status</b>: Stable </p>
</blockquote>
<p>This guide covers the OpenTelemetry (OTLP) integration in logger_system, enabling seamless correlation between logs, traces, and metrics for cloud-native observability.</p>
<h1><a class="anchor" id="autotoc_md1501"></a>
Table of Contents</h1>
<ul>
<li>Overview</li>
<li>Installation</li>
<li>Quick Start</li>
<li>Configuration</li>
<li>Trace Context</li>
<li>OTLP Writer</li>
<li>Integration Examples</li>
<li>Best Practices</li>
<li>Troubleshooting</li>
</ul>
<h1><a class="anchor" id="autotoc_md1502"></a>
Overview</h1>
<p>OpenTelemetry is the CNCF standard for observability, providing unified APIs for traces, metrics, and logs. Logger System's OTLP integration enables:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Feature   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Trace Correlation</b>   </td><td class="markdownTableBodyNone">Logs linked to distributed traces via trace_id/span_id    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Unified Export</b>   </td><td class="markdownTableBodyNone">Single protocol for exporting to observability platforms    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Ecosystem Support</b>   </td><td class="markdownTableBodyNone">Works with Jaeger, Zipkin, Prometheus, Grafana, Datadog    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Context Propagation</b>   </td><td class="markdownTableBodyNone">Automatic thread-local context handling   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md1503"></a>
Installation</h1>
<h2><a class="anchor" id="autotoc_md1504"></a>
With vcpkg</h2>
<div class="fragment"><div class="line"># Install with OTLP support</div>
<div class="line">vcpkg install kcenon-logger-system[otlp]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1505"></a>
With CMake</h2>
<div class="fragment"><div class="line">cmake -B build -DLOGGER_ENABLE_OTLP=ON</div>
<div class="line">cmake --build build</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1506"></a>
Dependencies</h2>
<p>The OTLP feature requires:</p><ul>
<li>opentelemetry-cpp</li>
<li>protobuf</li>
<li>grpc (for gRPC transport)</li>
</ul>
<h1><a class="anchor" id="autotoc_md1507"></a>
Quick Start</h1>
<h2><a class="anchor" id="autotoc_md1508"></a>
Basic OTLP Export</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/core/logger_builder.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/writers/otlp_writer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/otlp/otel_context.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>kcenon::logger;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Configure OTLP writer</span></div>
<div class="line">    otlp_writer::config otlp_cfg{</div>
<div class="line">        .endpoint = <span class="stringliteral">&quot;http://otel-collector:4318/v1/logs&quot;</span>,</div>
<div class="line">        .protocol = otlp_writer::protocol_type::http,</div>
<div class="line">        .service_name = <span class="stringliteral">&quot;my-service&quot;</span>,</div>
<div class="line">        .service_version = <span class="stringliteral">&quot;1.0.0&quot;</span>,</div>
<div class="line">        .resource_attributes = {</div>
<div class="line">            {<span class="stringliteral">&quot;environment&quot;</span>, <span class="stringliteral">&quot;production&quot;</span>},</div>
<div class="line">            {<span class="stringliteral">&quot;region&quot;</span>, <span class="stringliteral">&quot;us-east-1&quot;</span>}</div>
<div class="line">        }</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Build logger with OTLP writer</span></div>
<div class="line">    <span class="keyword">auto</span> result = logger_builder()</div>
<div class="line">        .with_async(<span class="keyword">true</span>)</div>
<div class="line">        .add_writer(<span class="stringliteral">&quot;otlp&quot;</span>, std::make_unique&lt;otlp_writer&gt;(otlp_cfg))</div>
<div class="line">        .build();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (result.is_err()) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> logger = std::move(result.value());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Logs are now exported to OpenTelemetry Collector</span></div>
<div class="line">    logger-&gt;log(log_level::info, <span class="stringliteral">&quot;Application started&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1509"></a>
With Trace Correlation</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/otlp/otel_context.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handle_request(<span class="keyword">const</span> Request&amp; req, logger* log) {</div>
<div class="line">    <span class="comment">// Extract trace context from incoming request headers</span></div>
<div class="line">    otlp::otel_context ctx{</div>
<div class="line">        .trace_id = req.headers[<span class="stringliteral">&quot;traceparent&quot;</span>].substr(3, 32),</div>
<div class="line">        .span_id = req.headers[<span class="stringliteral">&quot;traceparent&quot;</span>].substr(36, 16),</div>
<div class="line">        .trace_flags = <span class="stringliteral">&quot;01&quot;</span></div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set context for this thread</span></div>
<div class="line">    log-&gt;set_otel_context(ctx);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// All logs now include trace_id and span_id</span></div>
<div class="line">    log-&gt;log(log_level::info, <span class="stringliteral">&quot;Processing request&quot;</span>);</div>
<div class="line">    process_request(req);</div>
<div class="line">    log-&gt;log(log_level::info, <span class="stringliteral">&quot;Request completed&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Clear context when done</span></div>
<div class="line">    log-&gt;clear_otel_context();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1510"></a>
Using RAII Scope Guard</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/otlp/otel_context.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handle_request(<span class="keyword">const</span> Request&amp; req) {</div>
<div class="line">    otlp::otel_context ctx{</div>
<div class="line">        .trace_id = extract_trace_id(req),</div>
<div class="line">        .span_id = extract_span_id(req)</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Automatically clears context when scope ends</span></div>
<div class="line">    otlp::otel_context_scope scope(ctx);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// All logs in this scope include trace context</span></div>
<div class="line">    process_request(req);</div>
<div class="line">} <span class="comment">// Context automatically cleared here</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1511"></a>
Configuration</h1>
<h2><a class="anchor" id="autotoc_md1512"></a>
OTLP Writer Configuration</h2>
<div class="fragment"><div class="line">otlp_writer::config cfg{</div>
<div class="line">    <span class="comment">// Endpoint URL</span></div>
<div class="line">    <span class="comment">// HTTP: http://host:4318/v1/logs</span></div>
<div class="line">    <span class="comment">// gRPC: host:4317</span></div>
<div class="line">    .endpoint = <span class="stringliteral">&quot;http://localhost:4318/v1/logs&quot;</span>,</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Transport protocol (http or grpc)</span></div>
<div class="line">    .protocol = otlp_writer::protocol_type::http,</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Connection timeout</span></div>
<div class="line">    .timeout = std::chrono::milliseconds{5000},</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Enable TLS</span></div>
<div class="line">    .use_tls = <span class="keyword">false</span>,</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Service identification (required)</span></div>
<div class="line">    .service_name = <span class="stringliteral">&quot;my-service&quot;</span>,</div>
<div class="line">    .service_version = <span class="stringliteral">&quot;1.0.0&quot;</span>,</div>
<div class="line">    .service_namespace = <span class="stringliteral">&quot;production&quot;</span>,</div>
<div class="line">    .service_instance_id = <span class="stringliteral">&quot;pod-abc123&quot;</span>,</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Custom resource attributes</span></div>
<div class="line">    .resource_attributes = {</div>
<div class="line">        {<span class="stringliteral">&quot;deployment.environment&quot;</span>, <span class="stringliteral">&quot;production&quot;</span>},</div>
<div class="line">        {<span class="stringliteral">&quot;cloud.region&quot;</span>, <span class="stringliteral">&quot;us-east-1&quot;</span>},</div>
<div class="line">        {<span class="stringliteral">&quot;host.name&quot;</span>, <span class="stringliteral">&quot;server-01&quot;</span>}</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Batching configuration</span></div>
<div class="line">    .max_batch_size = 512,           <span class="comment">// Max logs per batch</span></div>
<div class="line">    .flush_interval = std::chrono::milliseconds{5000},  <span class="comment">// Max wait time</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Queue management</span></div>
<div class="line">    .max_queue_size = 10000,         <span class="comment">// Max queued logs (drops if exceeded)</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Retry configuration</span></div>
<div class="line">    .max_retries = 3,</div>
<div class="line">    .retry_delay = std::chrono::milliseconds{100},  <span class="comment">// Exponential backoff</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Authentication headers</span></div>
<div class="line">    .headers = {</div>
<div class="line">        {<span class="stringliteral">&quot;Authorization&quot;</span>, <span class="stringliteral">&quot;Bearer token123&quot;</span>}</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1513"></a>
Protocol Selection</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Protocol   </th><th class="markdownTableHeadNone">Port   </th><th class="markdownTableHeadNone">Use Case    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">HTTP   </td><td class="markdownTableBodyNone">4318   </td><td class="markdownTableBodyNone">Simpler setup, firewall-friendly    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">gRPC   </td><td class="markdownTableBodyNone">4317   </td><td class="markdownTableBodyNone">Better performance, streaming support   </td></tr>
</table>
<div class="fragment"><div class="line"><span class="comment">// HTTP endpoint (default)</span></div>
<div class="line">cfg.endpoint = <span class="stringliteral">&quot;http://collector:4318/v1/logs&quot;</span>;</div>
<div class="line">cfg.protocol = otlp_writer::protocol_type::http;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// gRPC endpoint</span></div>
<div class="line">cfg.endpoint = <span class="stringliteral">&quot;collector:4317&quot;</span>;</div>
<div class="line">cfg.protocol = otlp_writer::protocol_type::grpc;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1514"></a>
Trace Context</h1>
<h2><a class="anchor" id="autotoc_md1515"></a>
otel_context Structure</h2>
<div class="fragment"><div class="line"><span class="keyword">struct </span>otel_context {</div>
<div class="line">    std::string trace_id;      <span class="comment">// 32 hex chars (128 bits)</span></div>
<div class="line">    std::string span_id;       <span class="comment">// 16 hex chars (64 bits)</span></div>
<div class="line">    std::string trace_flags;   <span class="comment">// 2 hex chars (&quot;00&quot; or &quot;01&quot;)</span></div>
<div class="line">    std::string trace_state;   <span class="comment">// Vendor-specific data</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> is_valid() <span class="keyword">const</span>;     <span class="comment">// Check format validity</span></div>
<div class="line">    <span class="keywordtype">bool</span> is_sampled() <span class="keyword">const</span>;   <span class="comment">// Check if trace is sampled</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1516"></a>
Thread-Local Storage</h2>
<div class="fragment"><div class="line"><span class="comment">// Set context for current thread</span></div>
<div class="line">otlp::otel_context_storage::set(ctx);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get current context</span></div>
<div class="line"><span class="keyword">auto</span> ctx_opt = otlp::otel_context_storage::get();</div>
<div class="line"><span class="keywordflow">if</span> (ctx_opt) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Trace ID: &quot;</span> &lt;&lt; ctx_opt-&gt;trace_id &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check if context exists</span></div>
<div class="line"><span class="keywordflow">if</span> (otlp::otel_context_storage::has_context()) {</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Clear context</span></div>
<div class="line">otlp::otel_context_storage::clear();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1517"></a>
Context in Log Entries</h2>
<div class="fragment"><div class="line"><span class="comment">// log_entry automatically captures thread-local context</span></div>
<div class="line">log_entry entry(log_level::info, <span class="stringliteral">&quot;Message&quot;</span>);</div>
<div class="line"><span class="comment">// entry.otel_ctx is automatically populated from thread-local storage</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Or set explicitly</span></div>
<div class="line">entry.otel_ctx = otlp::otel_context{</div>
<div class="line">    .trace_id = <span class="stringliteral">&quot;...&quot;</span>,</div>
<div class="line">    .span_id = <span class="stringliteral">&quot;...&quot;</span></div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1518"></a>
OTLP Writer</h1>
<h2><a class="anchor" id="autotoc_md1519"></a>
Statistics Monitoring</h2>
<div class="fragment"><div class="line">otlp_writer writer(cfg);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get export statistics</span></div>
<div class="line"><span class="keyword">auto</span> stats = writer.get_stats();</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Logs exported: &quot;</span> &lt;&lt; stats.logs_exported &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Logs dropped: &quot;</span> &lt;&lt; stats.logs_dropped &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Export successes: &quot;</span> &lt;&lt; stats.export_success &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Export failures: &quot;</span> &lt;&lt; stats.export_failures &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Retries: &quot;</span> &lt;&lt; stats.retries &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1520"></a>
Health Checking</h2>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!writer.is_healthy()) {</div>
<div class="line">    <span class="comment">// Collector may be unavailable</span></div>
<div class="line">    <span class="comment">// Writer will retry automatically</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1521"></a>
Force Flush</h2>
<div class="fragment"><div class="line"><span class="comment">// Export all queued logs immediately</span></div>
<div class="line">writer.force_export();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Or use flush()</span></div>
<div class="line">writer.flush();</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1522"></a>
Integration Examples</h1>
<h2><a class="anchor" id="autotoc_md1523"></a>
With OpenTelemetry Collector</h2>
<div class="fragment"><div class="line"># otel-collector-config.yaml</div>
<div class="line">receivers:</div>
<div class="line">  otlp:</div>
<div class="line">    protocols:</div>
<div class="line">      http:</div>
<div class="line">        endpoint: 0.0.0.0:4318</div>
<div class="line">      grpc:</div>
<div class="line">        endpoint: 0.0.0.0:4317</div>
<div class="line"> </div>
<div class="line">exporters:</div>
<div class="line">  jaeger:</div>
<div class="line">    endpoint: jaeger:14250</div>
<div class="line">    tls:</div>
<div class="line">      insecure: true</div>
<div class="line">  loki:</div>
<div class="line">    endpoint: http://loki:3100/loki/api/v1/push</div>
<div class="line"> </div>
<div class="line">service:</div>
<div class="line">  pipelines:</div>
<div class="line">    logs:</div>
<div class="line">      receivers: [otlp]</div>
<div class="line">      exporters: [loki]</div>
<div class="line">    traces:</div>
<div class="line">      receivers: [otlp]</div>
<div class="line">      exporters: [jaeger]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1524"></a>
Docker Compose Setup</h2>
<div class="fragment"><div class="line">version: &#39;3.8&#39;</div>
<div class="line">services:</div>
<div class="line">  otel-collector:</div>
<div class="line">    image: otel/opentelemetry-collector-contrib:latest</div>
<div class="line">    volumes:</div>
<div class="line">      - ./otel-collector-config.yaml:/etc/otelcol/config.yaml</div>
<div class="line">    ports:</div>
<div class="line">      - &quot;4317:4317&quot;  # gRPC</div>
<div class="line">      - &quot;4318:4318&quot;  # HTTP</div>
<div class="line"> </div>
<div class="line">  jaeger:</div>
<div class="line">    image: jaegertracing/all-in-one:latest</div>
<div class="line">    ports:</div>
<div class="line">      - &quot;16686:16686&quot;  # UI</div>
<div class="line">      - &quot;14250:14250&quot;  # gRPC</div>
<div class="line"> </div>
<div class="line">  loki:</div>
<div class="line">    image: grafana/loki:latest</div>
<div class="line">    ports:</div>
<div class="line">      - &quot;3100:3100&quot;</div>
<div class="line"> </div>
<div class="line">  grafana:</div>
<div class="line">    image: grafana/grafana:latest</div>
<div class="line">    ports:</div>
<div class="line">      - &quot;3000:3000&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1525"></a>
W3C Trace Context Parsing</h2>
<div class="fragment"><div class="line"><span class="comment">// Parse W3C traceparent header</span></div>
<div class="line"><span class="comment">// Format: version-trace_id-span_id-trace_flags</span></div>
<div class="line"><span class="comment">// Example: 00-0af7651916cd43dd8448eb211c80319c-b7ad6b7169203331-01</span></div>
<div class="line"> </div>
<div class="line">std::optional&lt;otlp::otel_context&gt; parse_traceparent(<span class="keyword">const</span> std::string&amp; header) {</div>
<div class="line">    <span class="keywordflow">if</span> (header.length() &lt; 55 || header[0] != <span class="charliteral">&#39;0&#39;</span> || header[1] != <span class="charliteral">&#39;0&#39;</span>) {</div>
<div class="line">        <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> otlp::otel_context{</div>
<div class="line">        .trace_id = header.substr(3, 32),</div>
<div class="line">        .span_id = header.substr(36, 16),</div>
<div class="line">        .trace_flags = header.substr(53, 2)</div>
<div class="line">    };</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1526"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md1527"></a>
1. Always Set Service Name</h2>
<div class="fragment"><div class="line">cfg.service_name = <span class="stringliteral">&quot;api-gateway&quot;</span>;  <span class="comment">// Required for proper identification</span></div>
<div class="line">cfg.service_version = <span class="stringliteral">&quot;1.2.3&quot;</span>;     <span class="comment">// Helps with debugging</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1528"></a>
2. Use RAII Scope Guards</h2>
<div class="fragment"><div class="line"><span class="comment">// Preferred: automatic cleanup</span></div>
<div class="line">{</div>
<div class="line">    otlp::otel_context_scope scope(ctx);</div>
<div class="line">    <span class="comment">// ... process request ...</span></div>
<div class="line">} <span class="comment">// Context cleared automatically</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Avoid: manual cleanup (error-prone)</span></div>
<div class="line">ctx_storage::set(ctx);</div>
<div class="line"><span class="comment">// ... if exception thrown, context leaks ...</span></div>
<div class="line">ctx_storage::clear();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1529"></a>
3. Configure Appropriate Batch Sizes</h2>
<div class="fragment"><div class="line"><span class="comment">// High-throughput service</span></div>
<div class="line">cfg.max_batch_size = 1000;</div>
<div class="line">cfg.flush_interval = std::chrono::seconds{1};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Low-latency service</span></div>
<div class="line">cfg.max_batch_size = 100;</div>
<div class="line">cfg.flush_interval = std::chrono::milliseconds{500};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1530"></a>
4. Handle Collector Unavailability</h2>
<div class="fragment"><div class="line"><span class="comment">// Large queue for temporary outages</span></div>
<div class="line">cfg.max_queue_size = 50000;</div>
<div class="line">cfg.max_retries = 5;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Monitor health</span></div>
<div class="line"><span class="keywordflow">if</span> (!writer.is_healthy()) {</div>
<div class="line">    <span class="comment">// Alert operations team</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1531"></a>
5. Include Meaningful Resource Attributes</h2>
<div class="fragment"><div class="line">cfg.resource_attributes = {</div>
<div class="line">    {<span class="stringliteral">&quot;deployment.environment&quot;</span>, <span class="stringliteral">&quot;production&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;service.namespace&quot;</span>, <span class="stringliteral">&quot;payments&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;cloud.provider&quot;</span>, <span class="stringliteral">&quot;aws&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;cloud.region&quot;</span>, <span class="stringliteral">&quot;us-east-1&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;k8s.pod.name&quot;</span>, get_pod_name()},</div>
<div class="line">    {<span class="stringliteral">&quot;k8s.namespace.name&quot;</span>, get_namespace()}</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1532"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md1533"></a>
Logs Not Appearing in Collector</h2>
<ol type="1">
<li><b>Check endpoint URL</b>: Ensure correct port (4318 for HTTP, 4317 for gRPC)</li>
<li><b>Verify network connectivity</b>: Test with curl or grpcurl</li>
<li><b>Check collector logs</b>: Look for parsing or connection errors</li>
<li><b>Verify TLS settings</b>: Match use_tls with collector configuration</li>
</ol>
<h2><a class="anchor" id="autotoc_md1534"></a>
High Log Drop Rate</h2>
<div class="fragment"><div class="line"><span class="comment">// Increase queue size</span></div>
<div class="line">cfg.max_queue_size = 100000;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Increase batch size for higher throughput</span></div>
<div class="line">cfg.max_batch_size = 2000;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check stats for bottleneck</span></div>
<div class="line"><span class="keyword">auto</span> stats = writer.get_stats();</div>
<div class="line"><span class="keywordflow">if</span> (stats.logs_dropped &gt; 0) {</div>
<div class="line">    <span class="comment">// Queue overflow - increase size or reduce log volume</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1535"></a>
Connection Timeouts</h2>
<div class="fragment"><div class="line"><span class="comment">// Increase timeout for slow networks</span></div>
<div class="line">cfg.timeout = std::chrono::seconds{30};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Increase retry attempts</span></div>
<div class="line">cfg.max_retries = 5;</div>
<div class="line">cfg.retry_delay = std::chrono::seconds{1};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1536"></a>
Missing Trace Context</h2>
<ol type="1">
<li><b>Verify context is set before logging</b>: <div class="fragment"><div class="line">log-&gt;set_otel_context(ctx);</div>
<div class="line">log-&gt;log(level, msg);  <span class="comment">// Context must be set first</span></div>
</div><!-- fragment --></li>
<li><b>Check thread isolation</b>: Context is thread-local</li>
<li><b>Use scope guards</b> for automatic cleanup</li>
</ol>
<h1><a class="anchor" id="autotoc_md1537"></a>
Related Documentation</h1>
<ul>
<li><a href="../FEATURES.md#writer-types">Writer Types</a></li>
<li><a class="el" href="md__2home_2runner_2work_2logger__system_2logger__system_2docs_2guides_2SECURITY.html">Security Guide</a></li>
<li><a class="el" href="md__2home_2runner_2work_2logger__system_2logger__system_2docs_2guides_2INTEGRATION.html">Integration Guide</a></li>
<li><a href="https://opentelemetry.io/docs/specs/">OpenTelemetry Specification</a></li>
<li><a href="https://www.w3.org/TR/trace-context/">W3C Trace Context</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Jan 11 2026 06:56:05 for Logger System by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
