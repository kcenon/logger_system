<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Logger System: Log Server and Crash-Safe Logger</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Logger System<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-performance C++20 thread-safe logging system with asynchronous capabilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__2home_2runner_2work_2logger__system_2logger__system_2docs_2LOG__SERVER__AND__CRASH__SAFETY.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Log Server and Crash-Safe Logger</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2069"></a> </p><blockquote class="doxtable">
<p>&zwj;<b>Version</b>: 1.0.0 <b>Last Updated</b>: 2025-02-09 <b>Status</b>: Production Ready </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md2070"></a>
Table of Contents</h1>
<ul>
<li>Overview</li>
<li>Log Server<ul>
<li>Architecture</li>
<li>Configuration</li>
<li>API Reference</li>
<li>Deployment Patterns</li>
<li>Integration Examples</li>
</ul>
</li>
<li>Crash-Safe Logger<ul>
<li>Crash Safety Mechanism</li>
<li>Configuration</li>
<li>API Reference</li>
<li>Performance Overhead</li>
<li>When to Use</li>
</ul>
</li>
<li>Combined Usage<ul>
<li>Local Crash Safety + Network Forwarding</li>
<li>Server-Side Crash Safety</li>
<li>Complete Production Topology</li>
</ul>
</li>
<li>Best Practices</li>
<li>Troubleshooting</li>
<li>Related Documentation</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md2072"></a>
Overview</h1>
<p>logger_system provides two advanced features for production-grade logging infrastructure:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Feature   </th><th class="markdownTableHeadNone">Purpose   </th><th class="markdownTableHeadNone">Key Benefit    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Log Server</b>   </td><td class="markdownTableBodyNone">Centralized log collection server   </td><td class="markdownTableBodyNone">Aggregates logs from distributed applications    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Crash-Safe Logger</b>   </td><td class="markdownTableBodyNone">Guaranteed log persistence during crashes   </td><td class="markdownTableBodyNone">Zero data loss during application failures   </td></tr>
</table>
<p><b>Distributed Logging Topology</b>:</p>
<div class="fragment"><div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚                    Production Environment                 â”‚</div>
<div class="line">â”‚                                                           â”‚</div>
<div class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚</div>
<div class="line">â”‚  â”‚ App Node 1  â”‚  â”‚ App Node 2  â”‚  â”‚ App Node N  â”‚     â”‚</div>
<div class="line">â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚     â”‚</div>
<div class="line">â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚</div>
<div class="line">â”‚  â”‚ â”‚crash_safeâ”‚ â”‚  â”‚ â”‚crash_safeâ”‚ â”‚  â”‚ â”‚crash_safeâ”‚ â”‚     â”‚</div>
<div class="line">â”‚  â”‚ â”‚_logger   â”‚ â”‚  â”‚ â”‚_logger   â”‚ â”‚  â”‚ â”‚_logger   â”‚ â”‚     â”‚</div>
<div class="line">â”‚  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚     â”‚</div>
<div class="line">â”‚  â”‚      â”‚      â”‚  â”‚      â”‚      â”‚  â”‚      â”‚      â”‚     â”‚</div>
<div class="line">â”‚  â”‚   network   â”‚  â”‚   network   â”‚  â”‚   network   â”‚     â”‚</div>
<div class="line">â”‚  â”‚   _writer   â”‚  â”‚   _writer   â”‚  â”‚   _writer   â”‚     â”‚</div>
<div class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜     â”‚</div>
<div class="line">â”‚         â”‚                â”‚                â”‚             â”‚</div>
<div class="line">â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚</div>
<div class="line">â”‚                          â–¼                              â”‚</div>
<div class="line">â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚</div>
<div class="line">â”‚                   â”‚ log_server  â”‚                       â”‚</div>
<div class="line">â”‚                   â”‚  (Port 9999)â”‚                       â”‚</div>
<div class="line">â”‚                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                       â”‚</div>
<div class="line">â”‚                          â”‚                              â”‚</div>
<div class="line">â”‚                   rotating_file_writer                  â”‚</div>
<div class="line">â”‚                          â”‚                              â”‚</div>
<div class="line">â”‚                          â–¼                              â”‚</div>
<div class="line">â”‚                 /var/log/aggregated/                    â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
</div><!-- fragment --><p><b>Key Benefits</b>:</p><ul>
<li><b>Centralized Management</b>: Single collection point for distributed application logs</li>
<li><b>Crash Resilience</b>: Logs survive application crashes via signal handlers</li>
<li><b>Zero Data Loss</b>: Emergency flush ensures critical logs reach persistent storage</li>
<li><b>Production Ready</b>: Thread-safe, performant, and battle-tested</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md2074"></a>
Log Server</h1>
<h2><a class="anchor" id="autotoc_md2075"></a>
Architecture</h2>
<p>The log server acts as a centralized collection point in a distributed logging topology.</p>
<h3><a class="anchor" id="autotoc_md2076"></a>
Components</h3>
<div class="fragment"><div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚                      log_server                          â”‚</div>
<div class="line">â”‚                                                          â”‚</div>
<div class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚</div>
<div class="line">â”‚  â”‚   Worker 1   â”‚  â”‚   Worker 2   â”‚  â”‚   Worker N   â”‚  â”‚</div>
<div class="line">â”‚  â”‚   Thread     â”‚  â”‚   Thread     â”‚  â”‚   Thread     â”‚  â”‚</div>
<div class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚</div>
<div class="line">â”‚         â”‚                 â”‚                 â”‚           â”‚</div>
<div class="line">â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚</div>
<div class="line">â”‚                           â”‚                             â”‚</div>
<div class="line">â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                      â”‚</div>
<div class="line">â”‚                    â”‚  Connection  â”‚                      â”‚</div>
<div class="line">â”‚                    â”‚   Handler    â”‚                      â”‚</div>
<div class="line">â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚</div>
<div class="line">â”‚                           â”‚                             â”‚</div>
<div class="line">â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                      â”‚</div>
<div class="line">â”‚                    â”‚   Storage    â”‚                      â”‚</div>
<div class="line">â”‚                    â”‚  (Writers)   â”‚                      â”‚</div>
<div class="line">â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
</div><!-- fragment --><p><b>Header File</b>: <code>include/kcenon/logger/server/log_server.h</code></p>
<h3><a class="anchor" id="autotoc_md2077"></a>
Role in Distributed Logging</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">Role   </th><th class="markdownTableHeadNone">Interaction    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Client Applications</b>   </td><td class="markdownTableBodyNone">Generate logs   </td><td class="markdownTableBodyNone">Send to server via <code>network_writer</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Log Server</b>   </td><td class="markdownTableBodyNone">Aggregate logs   </td><td class="markdownTableBodyNone">Receive from all clients    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Storage Backend</b>   </td><td class="markdownTableBodyNone">Persist logs   </td><td class="markdownTableBodyNone">Files, databases, or external systems (ELK, Loki)   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md2078"></a>
Protocol</h3>
<p>The log server communicates with clients using the <code>network_writer</code> protocol:</p>
<ol type="1">
<li><b>Connection</b>: Client establishes TCP connection to server</li>
<li><b>Authentication</b>: Optional credential verification</li>
<li><b>Message Transfer</b>: Client sends serialized log messages</li>
<li><b>Compression</b>: Optional gzip compression for large messages</li>
<li><b>Encryption</b>: Optional TLS encryption for secure transport</li>
</ol>
<h2><a class="anchor" id="autotoc_md2079"></a>
Configuration</h2>
<h3><a class="anchor" id="autotoc_md2080"></a>
server_config Structure</h3>
<div class="fragment"><div class="line"><span class="keyword">struct </span>server_config {</div>
<div class="line">    std::string host = <span class="stringliteral">&quot;localhost&quot;</span>;      <span class="comment">// Bind address</span></div>
<div class="line">    uint16_t port = 9999;                <span class="comment">// Listen port</span></div>
<div class="line">    <span class="keywordtype">size_t</span> max_connections = 100;        <span class="comment">// Maximum concurrent clients</span></div>
<div class="line">    <span class="keywordtype">size_t</span> buffer_size = 8192;           <span class="comment">// Per-connection buffer (bytes)</span></div>
<div class="line">    <span class="keywordtype">bool</span> enable_compression = <span class="keyword">false</span>;     <span class="comment">// Enable gzip compression</span></div>
<div class="line">    <span class="keywordtype">bool</span> enable_encryption = <span class="keyword">false</span>;      <span class="comment">// Enable TLS/SSL</span></div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2081"></a>
Configuration Examples</h3>
<details >
<summary >
<b>Basic Configuration</b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/server/log_server.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Default configuration</span></div>
<div class="line">server_config config;</div>
<div class="line">config.host = <span class="stringliteral">&quot;0.0.0.0&quot;</span>;  <span class="comment">// Listen on all interfaces</span></div>
<div class="line">config.port = 9999;</div>
<div class="line">config.max_connections = 50;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> server = log_server_factory::create_basic(config);</div>
<div class="line">server-&gt;start();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Server is now accepting connections on 0.0.0.0:9999</span></div>
</div><!-- fragment --><p><b>Use Case</b>: Development environment with basic logging needs.</p>
<p></p>
</details>
<details >
<summary >
<b>High-Volume Configuration</b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">// High-throughput configuration</span></div>
<div class="line">server_config config;</div>
<div class="line">config.host = <span class="stringliteral">&quot;0.0.0.0&quot;</span>;</div>
<div class="line">config.port = 9999;</div>
<div class="line">config.max_connections = 500;       <span class="comment">// Support 500 concurrent clients</span></div>
<div class="line">config.buffer_size = 65536;         <span class="comment">// 64KB buffers for high throughput</span></div>
<div class="line">config.enable_compression = <span class="keyword">true</span>;   <span class="comment">// Reduce network bandwidth</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> server = log_server_factory::create_basic(config);</div>
<div class="line">server-&gt;start();</div>
</div><!-- fragment --><p><b>Use Case</b>: Production environment with hundreds of application instances.</p>
<p><b>Performance</b>: Handles 10,000+ messages/second with compression enabled.</p>
<p></p>
</details>
<details >
<summary >
<b>Secure Configuration</b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">// Secure production configuration</span></div>
<div class="line">server_config config;</div>
<div class="line">config.host = <span class="stringliteral">&quot;10.0.1.100&quot;</span>;         <span class="comment">// Internal network only</span></div>
<div class="line">config.port = 9999;</div>
<div class="line">config.max_connections = 200;</div>
<div class="line">config.enable_encryption = <span class="keyword">true</span>;    <span class="comment">// TLS encryption</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> server = log_server_factory::create_basic(config);</div>
<div class="line">server-&gt;start();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Note: TLS certificate/key configuration would be added via</span></div>
<div class="line"><span class="comment">// additional API methods (implementation-specific)</span></div>
</div><!-- fragment --><p><b>Use Case</b>: Production environment with security compliance requirements (PCI-DSS, HIPAA).</p>
<p><b>Security</b>: All log data encrypted in transit.</p>
<p></p>
</details>
<h2><a class="anchor" id="autotoc_md2082"></a>
API Reference</h2>
<h3><a class="anchor" id="autotoc_md2083"></a>
log_server Class</h3>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>kcenon::logger::server {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>log_server {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> log_server(<span class="keyword">const</span> server_config&amp; config = {});</div>
<div class="line">    ~log_server();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Lifecycle management</span></div>
<div class="line">    <span class="keywordtype">bool</span> start();                           <span class="comment">// Start server and worker threads</span></div>
<div class="line">    <span class="keywordtype">void</span> stop();                            <span class="comment">// Gracefully stop server</span></div>
<div class="line">    <span class="keywordtype">bool</span> is_running() <span class="keyword">const</span>;                <span class="comment">// Check server status</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Configuration access</span></div>
<div class="line">    <span class="keyword">const</span> server_config&amp; get_config() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> worker_loop();                     <span class="comment">// Internal worker thread implementation</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::logger::server</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2084"></a>
log_server_factory Class</h3>
<div class="fragment"><div class="line"><span class="keyword">class </span>log_server_factory {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Create server with custom configuration</span></div>
<div class="line">    <span class="keyword">static</span> std::unique_ptr&lt;log_server&gt; create_basic(</div>
<div class="line">        <span class="keyword">const</span> server_config&amp; config = {}</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create server with default configuration</span></div>
<div class="line">    <span class="keyword">static</span> std::unique_ptr&lt;log_server&gt; create_default();</div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2085"></a>
Method Details</h3>
<h4><a class="anchor" id="autotoc_md2086"></a>
start()</h4>
<p><b>Description</b>: Starts the log server and spawns worker threads.</p>
<p><b>Returns</b>: <code>bool</code> â€” <code>true</code> if started successfully, <code>false</code> if already running.</p>
<p><b>Thread Count</b>: Spawns <code>std::thread::hardware_concurrency()</code> worker threads (typically equal to CPU core count).</p>
<p><b>Example</b>: </p><div class="fragment"><div class="line"><span class="keyword">auto</span> server = log_server_factory::create_default();</div>
<div class="line"><span class="keywordflow">if</span> (server-&gt;start()) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Server started successfully\n&quot;</span>;</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Server already running\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md2087"></a>
stop()</h4>
<p><b>Description</b>: Gracefully stops the server and joins all worker threads.</p>
<p><b>Blocks</b>: Until all worker threads complete (may take up to 100ms per worker).</p>
<p><b>Example</b>: </p><div class="fragment"><div class="line">server-&gt;stop();</div>
<div class="line"><span class="comment">// All connections closed, workers stopped</span></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md2088"></a>
is_running()</h4>
<p><b>Description</b>: Checks if the server is currently running.</p>
<p><b>Returns</b>: <code>bool</code> â€” <code>true</code> if running, <code>false</code> otherwise.</p>
<p><b>Thread-Safe</b>: Yes (uses atomic operations).</p>
<p><b>Example</b>: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (server-&gt;is_running()) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Server status: RUNNING\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2089"></a>
Deployment Patterns</h2>
<h3><a class="anchor" id="autotoc_md2090"></a>
Pattern 1: Single Server with Multiple Clients</h3>
<div class="fragment"><div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚ Web Server  â”‚  â”‚ API Server  â”‚  â”‚ Worker Node â”‚</div>
<div class="line">â”‚ (Node 1)    â”‚  â”‚ (Node 2)    â”‚  â”‚ (Node 3)    â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">       â”‚                â”‚                â”‚</div>
<div class="line">       â”‚     network_writer (TCP)       â”‚</div>
<div class="line">       â”‚                â”‚                â”‚</div>
<div class="line">       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                        â–¼</div>
<div class="line">                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">                 â”‚ log_server  â”‚</div>
<div class="line">                 â”‚   :9999     â”‚</div>
<div class="line">                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                        â”‚</div>
<div class="line">                 rotating_file_writer</div>
<div class="line">                        â”‚</div>
<div class="line">                        â–¼</div>
<div class="line">              /var/log/aggregated/app.log</div>
</div><!-- fragment --><p><b>Configuration</b>:</p>
<p>Server: </p><div class="fragment"><div class="line">server_config config;</div>
<div class="line">config.host = <span class="stringliteral">&quot;10.0.1.100&quot;</span>;</div>
<div class="line">config.port = 9999;</div>
<div class="line">config.max_connections = 100;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> server = log_server_factory::create_basic(config);</div>
<div class="line">server-&gt;start();</div>
</div><!-- fragment --><p>Clients: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/writers/network_writer.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> logger = logger_builder::create()</div>
<div class="line">    .with_writer(std::make_unique&lt;network_writer&gt;(</div>
<div class="line">        <span class="stringliteral">&quot;10.0.1.100&quot;</span>,  <span class="comment">// Server IP</span></div>
<div class="line">        9999           <span class="comment">// Server port</span></div>
<div class="line">    ))</div>
<div class="line">    .build();</div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>Centralized log storage</li>
<li>Simplified log analysis</li>
<li>Reduced disk I/O on application nodes</li>
</ul>
<h3><a class="anchor" id="autotoc_md2091"></a>
Pattern 2: Log Aggregation for ELK Stack</h3>
<div class="fragment"><div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚                Application Fleet                         â”‚</div>
<div class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚</div>
<div class="line">â”‚  â”‚ App 1    â”‚  â”‚ App 2    â”‚  â”‚ App N    â”‚              â”‚</div>
<div class="line">â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚</div>
<div class="line">â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚</div>
<div class="line">â”‚                     â–¼                                    â”‚</div>
<div class="line">â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚</div>
<div class="line">â”‚              â”‚ log_server  â”‚                             â”‚</div>
<div class="line">â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                             â”‚</div>
<div class="line">â”‚                     â”‚                                    â”‚</div>
<div class="line">â”‚              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                             â”‚</div>
<div class="line">â”‚              â”‚ JSON Writer â”‚                             â”‚</div>
<div class="line">â”‚              â”‚ (Formatted) â”‚                             â”‚</div>
<div class="line">â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                             â”‚</div>
<div class="line">â”‚                     â–¼                                    â”‚</div>
<div class="line">â”‚            /var/log/json/app.log                         â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                      â”‚</div>
<div class="line">                  Filebeat</div>
<div class="line">                      â”‚</div>
<div class="line">                      â–¼</div>
<div class="line">              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">              â”‚ Elasticsearchâ”‚</div>
<div class="line">              â”‚   Logstash   â”‚</div>
<div class="line">              â”‚   Kibana     â”‚</div>
<div class="line">              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
</div><!-- fragment --><p><b>Server Configuration</b>: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/server/log_server.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/writers/file_writer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/formatters/json_formatter.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Log server writes JSON logs for Filebeat ingestion</span></div>
<div class="line">server_config config;</div>
<div class="line">config.host = <span class="stringliteral">&quot;0.0.0.0&quot;</span>;</div>
<div class="line">config.port = 9999;</div>
<div class="line">config.max_connections = 200;</div>
<div class="line">config.enable_compression = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> server = log_server_factory::create_basic(config);</div>
<div class="line">server-&gt;start();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Note: Actual storage writer would be configured separately</span></div>
<div class="line"><span class="comment">// via dependency injection or builder pattern</span></div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>Seamless integration with ELK stack</li>
<li>Centralized search and visualization</li>
<li>Historical log analysis</li>
</ul>
<h3><a class="anchor" id="autotoc_md2092"></a>
Pattern 3: Multi-Region Deployment</h3>
<div class="fragment"><div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚                   Region: us-east-1                      â”‚</div>
<div class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚</div>
<div class="line">â”‚  â”‚ App 1    â”‚  â”‚ App 2    â”‚                             â”‚</div>
<div class="line">â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                             â”‚</div>
<div class="line">â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚</div>
<div class="line">â”‚                     â–¼          â”‚                        â”‚</div>
<div class="line">â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                        â”‚</div>
<div class="line">â”‚              â”‚log_server 1 â”‚   â”‚                        â”‚</div>
<div class="line">â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚                        â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚</div>
<div class="line">                      â”‚</div>
<div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚                     â”‚          â”‚   Region: eu-west-1    â”‚</div>
<div class="line">â”‚                     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚</div>
<div class="line">â”‚                     â”‚    â”‚ App 3    â”‚  â”‚ App 4    â”‚    â”‚</div>
<div class="line">â”‚                     â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚</div>
<div class="line">â”‚                     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”   â”‚</div>
<div class="line">â”‚                     â”‚                       â–¼      â”‚   â”‚</div>
<div class="line">â”‚                     â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</div>
<div class="line">â”‚                     â”‚                â”‚log_server 2 â”‚   â”‚</div>
<div class="line">â”‚                     â”‚                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                      â”‚                       â”‚</div>
<div class="line">                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                                  â–¼</div>
<div class="line">                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">                         â”‚Central Log Storeâ”‚</div>
<div class="line">                         â”‚  (S3, GCS, etc) â”‚</div>
<div class="line">                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
</div><!-- fragment --><p><b>Configuration</b>:</p>
<p>Region 1 Server: </p><div class="fragment"><div class="line">server_config config_us;</div>
<div class="line">config_us.host = <span class="stringliteral">&quot;10.1.1.100&quot;</span>;</div>
<div class="line">config_us.port = 9999;</div>
<div class="line">config_us.max_connections = 500;</div>
</div><!-- fragment --><p>Region 2 Server: </p><div class="fragment"><div class="line">server_config config_eu;</div>
<div class="line">config_eu.host = <span class="stringliteral">&quot;10.2.1.100&quot;</span>;</div>
<div class="line">config_eu.port = 9999;</div>
<div class="line">config_eu.max_connections = 500;</div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>Low-latency logging within each region</li>
<li>Geographic redundancy</li>
<li>Centralized long-term storage</li>
</ul>
<h2><a class="anchor" id="autotoc_md2093"></a>
Integration Examples</h2>
<h3><a class="anchor" id="autotoc_md2094"></a>
Example 1: Basic Server Setup</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/server/log_server.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Create server with default configuration</span></div>
<div class="line">    <span class="keyword">auto</span> server = log_server_factory::create_default();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Start server</span></div>
<div class="line">    <span class="keywordflow">if</span> (!server-&gt;start()) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to start log server\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Log server running on &quot;</span></div>
<div class="line">              &lt;&lt; server-&gt;get_config().host &lt;&lt; <span class="stringliteral">&quot;:&quot;</span></div>
<div class="line">              &lt;&lt; server-&gt;get_config().port &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Keep server running until user interruption</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Press Enter to stop server...\n&quot;</span>;</div>
<div class="line">    std::cin.get();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Graceful shutdown</span></div>
<div class="line">    server-&gt;stop();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Server stopped\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2095"></a>
Example 2: Programmatic Control</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/server/log_server.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>LogServerManager {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    std::unique_ptr&lt;log_server&gt; server_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">bool</span> initialize() {</div>
<div class="line">        server_config config;</div>
<div class="line">        config.host = <span class="stringliteral">&quot;0.0.0.0&quot;</span>;</div>
<div class="line">        config.port = 9999;</div>
<div class="line">        config.max_connections = 200;</div>
<div class="line">        config.enable_compression = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">        server_ = log_server_factory::create_basic(config);</div>
<div class="line">        <span class="keywordflow">return</span> server_-&gt;start();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> run_health_check_loop() {</div>
<div class="line">        <span class="keywordflow">while</span> (server_-&gt;is_running()) {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Server status: HEALTHY\n&quot;</span>;</div>
<div class="line">            std::this_thread::sleep_for(std::chrono::seconds(30));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> shutdown() {</div>
<div class="line">        <span class="keywordflow">if</span> (server_ &amp;&amp; server_-&gt;is_running()) {</div>
<div class="line">            server_-&gt;stop();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ~LogServerManager() {</div>
<div class="line">        shutdown();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    LogServerManager manager;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!manager.initialize()) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to initialize log server\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    manager.run_health_check_loop();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2096"></a>
Example 3: Docker Deployment</h3>
<p><b>Dockerfile</b>: </p><div class="fragment"><div class="line">FROM ubuntu:22.04</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Install dependencies</span></div>
<div class="line">RUN apt-get update &amp;&amp; apt-get install -y \</div>
<div class="line">    libstdc++6 \</div>
<div class="line">    &amp;&amp; rm -rf /var/lib/apt/lists<span class="comment">/*</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># Copy log server binary</span></div>
<div class="line"><span class="comment">COPY log_server /usr/local/bin/</span></div>
<div class="line"><span class="comment">COPY libkcenon_logger.so /usr/local/lib/</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># Create log directory</span></div>
<div class="line"><span class="comment">RUN mkdir -p /var/log/aggregated</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># Expose port</span></div>
<div class="line"><span class="comment">EXPOSE 9999</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># Run server</span></div>
<div class="line"><span class="comment">CMD [&quot;/usr/local/bin/log_server&quot;, &quot;--host=0.0.0.0&quot;, &quot;--port=9999&quot;]</span></div>
</div><!-- fragment --><p><b>Docker Compose</b>: </p><div class="fragment"><div class="line">version: &#39;3.8&#39;</div>
<div class="line">services:</div>
<div class="line">  log-server:</div>
<div class="line">    build: .</div>
<div class="line">    ports:</div>
<div class="line">      - &quot;9999:9999&quot;</div>
<div class="line">    volumes:</div>
<div class="line">      - ./logs:/var/log/aggregated</div>
<div class="line">    restart: unless-stopped</div>
<div class="line">    environment:</div>
<div class="line">      - MAX_CONNECTIONS=500</div>
<div class="line">      - ENABLE_COMPRESSION=true</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md2098"></a>
Crash-Safe Logger</h1>
<h2><a class="anchor" id="autotoc_md2099"></a>
Crash Safety Mechanism</h2>
<p>The crash-safe logger guarantees log persistence during application crashes through <b>signal-based emergency flushing</b>.</p>
<h3><a class="anchor" id="autotoc_md2100"></a>
How It Works</h3>
<div class="fragment"><div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚              Normal Operation Flow                       â”‚</div>
<div class="line">â”‚                                                          â”‚</div>
<div class="line">â”‚  Application Code                                        â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â–¼                                                  â”‚</div>
<div class="line">â”‚  logger-&gt;log(...)                                        â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â–¼                                                  â”‚</div>
<div class="line">â”‚  crash_safe_logger                                       â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â–¼                                                  â”‚</div>
<div class="line">â”‚  underlying_logger (buffered)                            â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â–¼                                                  â”‚</div>
<div class="line">â”‚  Periodic Flush (auto_flush_interval)                    â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â–¼                                                  â”‚</div>
<div class="line">â”‚  Disk Storage                                            â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line"> </div>
<div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚              Crash Scenario Flow                         â”‚</div>
<div class="line">â”‚                                                          â”‚</div>
<div class="line">â”‚  Application Code                                        â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â–¼                                                  â”‚</div>
<div class="line">â”‚  âš ï¸  CRASH (SIGSEGV/SIGABRT)                            â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â–¼                                                  â”‚</div>
<div class="line">â”‚  Signal Handler (async-signal-safe)                      â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â–¼                                                  â”‚</div>
<div class="line">â”‚  emergency_flush()                                       â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â”œâ”€ Set emergency flag (atomic)                     â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â”œâ”€ Try flush_mutex_.try_lock()                     â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â””â”€ Flush buffered logs (best-effort)               â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â–¼                                                  â”‚</div>
<div class="line">â”‚  ğŸ’¾ Disk Storage (logs saved!)                          â”‚</div>
<div class="line">â”‚       â”‚                                                  â”‚</div>
<div class="line">â”‚       â–¼                                                  â”‚</div>
<div class="line">â”‚  Chain to original signal handler or exit               â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
</div><!-- fragment --><p><b>Header File</b>: <code>include/kcenon/logger/safety/crash_safe_logger.h</code></p>
<h3><a class="anchor" id="autotoc_md2101"></a>
Signal Handlers</h3>
<p>The crash-safe logger installs handlers for the following signals:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Signal   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Action    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>SIGSEGV</b>   </td><td class="markdownTableBodyNone">Segmentation fault (invalid memory access)   </td><td class="markdownTableBodyNone">Emergency flush + chain to old handler    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>SIGABRT</b>   </td><td class="markdownTableBodyNone">Abort signal (assert failures, <code>std::terminate()</code>)   </td><td class="markdownTableBodyNone">Emergency flush + chain to old handler    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>SIGTERM</b>   </td><td class="markdownTableBodyNone">Termination request (graceful shutdown)   </td><td class="markdownTableBodyNone">Emergency flush + exit    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>SIGINT</b>   </td><td class="markdownTableBodyNone">Interrupt signal (Ctrl+C)   </td><td class="markdownTableBodyNone">Emergency flush + exit   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md2102"></a>
Async-Signal-Safe Constraints</h3>
<p>Signal handlers must follow strict async-signal-safe rules:</p>
<p><b>Allowed Operations</b>:</p><ul>
<li>âœ… Atomic operations (<code>std::atomic</code>)</li>
<li>âœ… <code>try_lock()</code> (non-blocking mutex attempt)</li>
<li>âœ… Direct system calls (<code>write()</code>, <code>fsync()</code>)</li>
</ul>
<p><b>Forbidden Operations</b>:</p><ul>
<li>âŒ Memory allocation (<code>new</code>, <code>malloc()</code>)</li>
<li>âŒ <code>lock()</code> (blocking mutex)</li>
<li>âŒ Exception throwing</li>
<li>âŒ Non-reentrant library calls</li>
</ul>
<p><b>Rationale</b>: The application may crash while holding locks or during memory allocation, so the signal handler cannot rely on these mechanisms.</p>
<h3><a class="anchor" id="autotoc_md2103"></a>
Recovery Procedure</h3>
<p>After an application restart:</p>
<ol type="1">
<li><b>Detection</b>: Check for emergency flush flag or incomplete log files</li>
<li><b>Recovery</b>: Read any crash logs from emergency flush location</li>
<li><b>Analysis</b>: Parse crash logs to determine failure cause</li>
<li><b>Cleanup</b>: Remove emergency markers</li>
</ol>
<p><b>Note</b>: The current implementation focuses on emergency flushing. Full recovery API would be added in future versions.</p>
<h2><a class="anchor" id="autotoc_md2104"></a>
Crash-Safe Configuration</h2>
<h3><a class="anchor" id="autotoc_md2105"></a>
Basic Setup</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/safety/crash_safe_logger.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create crash-safe logger</span></div>
<div class="line"><span class="keyword">auto</span> safe_logger = crash_safe_logger::create();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Install signal handlers</span></div>
<div class="line"><span class="keywordflow">if</span> (!safe_logger-&gt;install_crash_handlers()) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to install crash handlers\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Start logging</span></div>
<div class="line">safe_logger-&gt;start();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use as normal logger</span></div>
<div class="line">safe_logger-&gt;log(log_level::info, <span class="stringliteral">&quot;Application started with crash protection&quot;</span>);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2106"></a>
Advanced Configuration</h3>
<div class="fragment"><div class="line"><span class="comment">// Create with custom underlying logger</span></div>
<div class="line"><span class="keyword">auto</span> base_logger = std::make_shared&lt;logger&gt;(</div>
<div class="line">    <span class="keyword">true</span>,   <span class="comment">// Use async mode</span></div>
<div class="line">    32768   <span class="comment">// 32KB buffer</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> safe_logger = crash_safe_logger::create(base_logger);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Install crash handlers</span></div>
<div class="line">safe_logger-&gt;install_crash_handlers();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Configure auto-flush for durability</span></div>
<div class="line">safe_logger-&gt;set_auto_flush_interval(std::chrono::seconds(5));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set log level</span></div>
<div class="line">safe_logger-&gt;set_min_level(log_level::debug);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Start logging</span></div>
<div class="line">safe_logger-&gt;start();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2107"></a>
Crash-Safe API Reference</h2>
<h3><a class="anchor" id="autotoc_md2108"></a>
crash_safe_logger Class</h3>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>kcenon::logger::safety {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>crash_safe_logger {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Factory method</span></div>
<div class="line">    <span class="keyword">static</span> std::shared_ptr&lt;crash_safe_logger&gt; create(</div>
<div class="line">        std::shared_ptr&lt;logger&gt; underlying_logger = <span class="keyword">nullptr</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Signal handler management</span></div>
<div class="line">    <span class="keywordtype">bool</span> install_crash_handlers();</div>
<div class="line">    <span class="keywordtype">void</span> uninstall_crash_handlers();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Flush operations</span></div>
<div class="line">    <span class="keywordtype">bool</span> flush_with_timeout(std::chrono::milliseconds timeout);</div>
<div class="line">    <span class="keywordtype">void</span> emergency_flush();  <span class="comment">// Async-signal-safe</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Log level management (thread-safe)</span></div>
<div class="line">    <span class="keywordtype">void</span> set_min_level(log_level level);</div>
<div class="line">    log_level get_min_level() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Auto-flush configuration</span></div>
<div class="line">    <span class="keywordtype">void</span> set_auto_flush_interval(std::chrono::milliseconds interval);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Logging methods</span></div>
<div class="line">    <span class="keywordtype">void</span> log(log_level level, <span class="keyword">const</span> std::string&amp; message);</div>
<div class="line">    <span class="keywordtype">void</span> log(log_level level,</div>
<div class="line">             <span class="keyword">const</span> std::string&amp; message,</div>
<div class="line">             <span class="keyword">const</span> std::string&amp; file,</div>
<div class="line">             <span class="keywordtype">int</span> line,</div>
<div class="line">             <span class="keyword">const</span> std::string&amp; function);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Lifecycle</span></div>
<div class="line">    common::VoidResult start();</div>
<div class="line">    common::VoidResult stop();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Access underlying logger</span></div>
<div class="line">    std::shared_ptr&lt;logger&gt; get_underlying_logger();</div>
<div class="line"> </div>
<div class="line">    ~crash_safe_logger();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kcenon::logger::safety</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2109"></a>
Method Details</h3>
<h4><a class="anchor" id="autotoc_md2110"></a>
create()</h4>
<p><b>Description</b>: Factory method to create a crash-safe logger instance.</p>
<p><b>Parameters</b>:</p><ul>
<li><code>underlying_logger</code> â€” Base logger to wrap (creates default if <code>nullptr</code>)</li>
</ul>
<p><b>Returns</b>: <code>std::shared_ptr&lt;crash_safe_logger&gt;</code></p>
<p><b>Default Underlying Logger</b>:</p><ul>
<li>Async mode: <code>true</code></li>
<li>Buffer size: <code>16384</code> bytes (16KB)</li>
</ul>
<p><b>Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// Create with default underlying logger</span></div>
<div class="line"><span class="keyword">auto</span> safe_logger = crash_safe_logger::create();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create with custom underlying logger</span></div>
<div class="line"><span class="keyword">auto</span> custom_logger = std::make_shared&lt;logger&gt;(<span class="keyword">true</span>, 65536);</div>
<div class="line"><span class="keyword">auto</span> safe_logger = crash_safe_logger::create(custom_logger);</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md2111"></a>
install_crash_handlers()</h4>
<p><b>Description</b>: Installs signal handlers for crash detection.</p>
<p><b>Returns</b>: <code>bool</code> â€” <code>true</code> if all handlers installed successfully, <code>false</code> otherwise.</p>
<p><b>Signals Handled</b>: SIGSEGV, SIGABRT, SIGTERM, SIGINT</p>
<p><b>Idempotent</b>: Safe to call multiple times (subsequent calls return <code>true</code> without reinstalling).</p>
<p><b>Example</b>: </p><div class="fragment"><div class="line"><span class="keyword">auto</span> safe_logger = crash_safe_logger::create();</div>
<div class="line"><span class="keywordflow">if</span> (!safe_logger-&gt;install_crash_handlers()) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to install signal handlers\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md2112"></a>
uninstall_crash_handlers()</h4>
<p><b>Description</b>: Removes signal handlers and restores original handlers.</p>
<p><b>Note</b>: Automatically called in destructor.</p>
<p><b>Example</b>: </p><div class="fragment"><div class="line">safe_logger-&gt;uninstall_crash_handlers();</div>
<div class="line"><span class="comment">// Original signal handlers restored</span></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md2113"></a>
flush_with_timeout()</h4>
<p><b>Description</b>: Flushes logs with a timeout to prevent deadlocks.</p>
<p><b>Parameters</b>:</p><ul>
<li><code>timeout</code> â€” Maximum time to wait for flush completion</li>
</ul>
<p><b>Returns</b>: <code>bool</code> â€” <code>true</code> if flushed successfully, <code>false</code> on timeout.</p>
<p><b>Use Case</b>: Graceful shutdown where you want to ensure logs are flushed but don't want to wait indefinitely.</p>
<p><b>Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// Try to flush within 2 seconds</span></div>
<div class="line"><span class="keywordflow">if</span> (!safe_logger-&gt;flush_with_timeout(std::chrono::seconds(2))) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Warning: Flush timed out\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md2114"></a>
emergency_flush()</h4>
<p><b>Description</b>: Performs best-effort flush in signal handler context.</p>
<p><b>Async-Signal-Safe</b>: Yes (no allocations, non-blocking locks only).</p>
<p><b>Returns</b>: <code>void</code> (always succeeds, but flush may be incomplete if locks held).</p>
<p><b>Note</b>: Typically called automatically by signal handler, not by user code.</p>
<p><b>Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// Rarely called directly (signal handler calls this)</span></div>
<div class="line">safe_logger-&gt;emergency_flush();</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md2115"></a>
set_auto_flush_interval()</h4>
<p><b>Description</b>: Configures automatic background flushing for data durability.</p>
<p><b>Parameters</b>:</p><ul>
<li><code>interval</code> â€” Time between auto-flushes (0 disables auto-flush)</li>
</ul>
<p><b>Spawns Thread</b>: Yes (background thread for periodic flushing).</p>
<p><b>Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// Flush every 5 seconds</span></div>
<div class="line">safe_logger-&gt;set_auto_flush_interval(std::chrono::seconds(5));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Disable auto-flush</span></div>
<div class="line">safe_logger-&gt;set_auto_flush_interval(std::chrono::milliseconds(0));</div>
</div><!-- fragment --><p><b>Trade-off</b>: More frequent flushes increase durability but may reduce performance.</p>
<h4><a class="anchor" id="autotoc_md2116"></a>
set_min_level() / get_min_level()</h4>
<p><b>Description</b>: Thread-safe log level management using atomic operations.</p>
<p><b>Parameters</b>:</p><ul>
<li><code>level</code> â€” Minimum log level to record</li>
</ul>
<p><b>Thread-Safe</b>: Yes (uses <code>std::atomic&lt;log_level&gt;</code>).</p>
<p><b>Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// Set minimum level to warning</span></div>
<div class="line">safe_logger-&gt;set_min_level(log_level::warning);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get current level</span></div>
<div class="line"><span class="keyword">auto</span> current_level = safe_logger-&gt;get_min_level();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2117"></a>
Performance Overhead</h2>
<h3><a class="anchor" id="autotoc_md2118"></a>
Benchmarks</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration   </th><th class="markdownTableHeadNone">Throughput   </th><th class="markdownTableHeadNone">Latency   </th><th class="markdownTableHeadNone">Overhead vs Standard Logger    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Standard logger</b>   </td><td class="markdownTableBodyNone">4.34M msg/sec   </td><td class="markdownTableBodyNone">148ns   </td><td class="markdownTableBodyNone">Baseline    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Crash-safe (no auto-flush)</b>   </td><td class="markdownTableBodyNone">4.28M msg/sec   </td><td class="markdownTableBodyNone">151ns   </td><td class="markdownTableBodyNone"><b>+2%</b> (signal handler check)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Crash-safe (5s auto-flush)</b>   </td><td class="markdownTableBodyNone">4.15M msg/sec   </td><td class="markdownTableBodyNone">155ns   </td><td class="markdownTableBodyNone"><b>+4.4%</b> (periodic flush)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Crash-safe (1s auto-flush)</b>   </td><td class="markdownTableBodyNone">3.89M msg/sec   </td><td class="markdownTableBodyNone">166ns   </td><td class="markdownTableBodyNone"><b>+10.4%</b> (frequent flush)   </td></tr>
</table>
<p><b>Test Environment</b>:</p><ul>
<li>CPU: Intel Xeon E5-2686 v4 (2.3 GHz)</li>
<li>Compiler: GCC 11.4.0</li>
<li>Optimization: <code>-O3 -march=native</code></li>
<li>Buffer size: 16KB</li>
</ul>
<h3><a class="anchor" id="autotoc_md2119"></a>
Overhead Sources</h3>
<ol type="1">
<li><b>Signal Handler Check</b> (~2%): Atomic operations for emergency flush flag</li>
<li><b>Auto-Flush Thread</b> (~2-8%): Depends on flush frequency and buffer size</li>
<li><b>Flush Timeout Logic</b> (~1%): Try-lock and deadline checking</li>
</ol>
<h3><a class="anchor" id="autotoc_md2120"></a>
Optimization Tips</h3>
<p><b>Minimize Overhead</b>: </p><div class="fragment"><div class="line"><span class="comment">// Use larger buffers to reduce flush frequency</span></div>
<div class="line"><span class="keyword">auto</span> base_logger = std::make_shared&lt;logger&gt;(<span class="keyword">true</span>, 65536);  <span class="comment">// 64KB</span></div>
<div class="line"><span class="keyword">auto</span> safe_logger = crash_safe_logger::create(base_logger);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set longer auto-flush interval</span></div>
<div class="line">safe_logger-&gt;set_auto_flush_interval(std::chrono::seconds(10));</div>
</div><!-- fragment --><p><b>Maximize Durability</b>: </p><div class="fragment"><div class="line"><span class="comment">// Use smaller buffers and frequent flushes</span></div>
<div class="line"><span class="keyword">auto</span> base_logger = std::make_shared&lt;logger&gt;(<span class="keyword">true</span>, 8192);  <span class="comment">// 8KB</span></div>
<div class="line"><span class="keyword">auto</span> safe_logger = crash_safe_logger::create(base_logger);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Flush every second</span></div>
<div class="line">safe_logger-&gt;set_auto_flush_interval(std::chrono::seconds(1));</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2121"></a>
When to Use</h2>
<h3><a class="anchor" id="autotoc_md2122"></a>
Use Crash-Safe Logger When:</h3>
<p>âœ… <b>Critical Financial Applications</b></p><ul>
<li>Trading systems</li>
<li>Payment gateways</li>
<li>Accounting software</li>
</ul>
<p><b>Reason</b>: Zero tolerance for data loss; logs required for auditing and compliance.</p>
<p>âœ… <b>Medical/Healthcare Systems</b></p><ul>
<li>Patient monitoring</li>
<li>Medical device control</li>
<li>Electronic health records</li>
</ul>
<p><b>Reason</b>: Regulatory requirements (FDA, HIPAA) mandate log completeness.</p>
<p>âœ… <b>Debugging Intermittent Crashes</b></p><ul>
<li>Hard-to-reproduce bugs</li>
<li>Production crash analysis</li>
<li>Post-mortem debugging</li>
</ul>
<p><b>Reason</b>: Logs may reveal crash cause that would otherwise be lost.</p>
<p>âœ… <b>Compliance Requirements</b></p><ul>
<li>SOC 2 auditing</li>
<li>PCI-DSS logging</li>
<li>GDPR data processing records</li>
</ul>
<p><b>Reason</b>: Audit logs must survive system failures.</p>
<h3><a class="anchor" id="autotoc_md2123"></a>
Do NOT Use When:</h3>
<p>âŒ <b>Low-Latency Requirements</b></p><ul>
<li>High-frequency trading (sub-microsecond latency)</li>
<li>Real-time control systems</li>
</ul>
<p><b>Reason</b>: 2-10% overhead may be unacceptable; use specialized logging instead.</p>
<p>âŒ <b>Development/Testing Environments</b></p><ul>
<li>Local development</li>
<li>Unit tests</li>
</ul>
<p><b>Reason</b>: No crash safety needed; standard logger is simpler and faster.</p>
<p>âŒ <b>Immutable Infrastructure</b></p><ul>
<li>Containers that restart on crash</li>
<li>Serverless functions</li>
</ul>
<p><b>Reason</b>: Logs are externalized before crash via centralized logging; crash safety redundant.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md2125"></a>
Combined Usage</h1>
<h2><a class="anchor" id="autotoc_md2126"></a>
Local Crash Safety + Network Forwarding</h2>
<p>Combine crash-safe logging locally with network forwarding to a central server.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/safety/crash_safe_logger.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/writers/network_writer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/writers/rotating_file_writer.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create local crash-safe file logger</span></div>
<div class="line"><span class="keyword">auto</span> local_file_writer = std::make_unique&lt;rotating_file_writer&gt;(</div>
<div class="line">    <span class="stringliteral">&quot;/var/log/app/local.log&quot;</span>,</div>
<div class="line">    10 * 1024 * 1024,  <span class="comment">// 10MB per file</span></div>
<div class="line">    5                  <span class="comment">// Keep 5 files</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> local_logger = std::make_shared&lt;logger&gt;(<span class="keyword">true</span>, 16384);</div>
<div class="line">local_logger-&gt;add_writer(std::move(local_file_writer));</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> safe_logger = crash_safe_logger::create(local_logger);</div>
<div class="line">safe_logger-&gt;install_crash_handlers();</div>
<div class="line">safe_logger-&gt;set_auto_flush_interval(std::chrono::seconds(5));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add network writer for centralized logging</span></div>
<div class="line"><span class="keyword">auto</span> network_writer = std::make_unique&lt;network_writer&gt;(</div>
<div class="line">    <span class="stringliteral">&quot;log-server.internal&quot;</span>,  <span class="comment">// Server hostname</span></div>
<div class="line">    9999                    <span class="comment">// Server port</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line">local_logger-&gt;add_writer(std::move(network_writer));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Start logging</span></div>
<div class="line">safe_logger-&gt;start();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Now logs go to BOTH local file (crash-safe) AND network server</span></div>
<div class="line">safe_logger-&gt;log(log_level::info, <span class="stringliteral">&quot;Application started with dual logging&quot;</span>);</div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>Local logs survive crashes (emergency flush to disk)</li>
<li>Centralized logs for aggregation and analysis</li>
<li>Redundancy: If network fails, local logs still captured</li>
</ul>
<p><b>Deployment Topology</b>:</p>
<div class="fragment"><div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚                  Application Node                        â”‚</div>
<div class="line">â”‚                                                          â”‚</div>
<div class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</div>
<div class="line">â”‚  â”‚            crash_safe_logger                     â”‚   â”‚</div>
<div class="line">â”‚  â”‚                                                  â”‚   â”‚</div>
<div class="line">â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚</div>
<div class="line">â”‚  â”‚  â”‚       underlying logger                    â”‚ â”‚   â”‚</div>
<div class="line">â”‚  â”‚  â”‚                                            â”‚ â”‚   â”‚</div>
<div class="line">â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚   â”‚</div>
<div class="line">â”‚  â”‚  â”‚  â”‚rotating_file    â”‚  â”‚network_writer   â”‚ â”‚ â”‚   â”‚</div>
<div class="line">â”‚  â”‚  â”‚  â”‚_writer          â”‚  â”‚                 â”‚ â”‚ â”‚   â”‚</div>
<div class="line">â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚   â”‚</div>
<div class="line">â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚</div>
<div class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</div>
<div class="line">â”‚                 â”‚                    â”‚                 â”‚</div>
<div class="line">â”‚                 â–¼                    â”‚                 â”‚</div>
<div class="line">â”‚    /var/log/app/local.log            â”‚                 â”‚</div>
<div class="line">â”‚    (CRASH-SAFE: emergency_flush)     â”‚                 â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                                       â”‚</div>
<div class="line">                                       â”‚ TCP (network)</div>
<div class="line">                                       â”‚</div>
<div class="line">                                       â–¼</div>
<div class="line">                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">                            â”‚   log_server     â”‚</div>
<div class="line">                            â”‚   (Centralized)  â”‚</div>
<div class="line">                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                                     â”‚</div>
<div class="line">                                     â–¼</div>
<div class="line">                       /var/log/aggregated/app.log</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2127"></a>
Server-Side Crash Safety</h2>
<p>Protect the log server itself from crashes.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/server/log_server.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/safety/crash_safe_logger.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create crash-safe logger for server&#39;s own logging</span></div>
<div class="line"><span class="keyword">auto</span> server_logger = crash_safe_logger::create();</div>
<div class="line">server_logger-&gt;install_crash_handlers();</div>
<div class="line">server_logger-&gt;set_auto_flush_interval(std::chrono::seconds(5));</div>
<div class="line">server_logger-&gt;start();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create log server</span></div>
<div class="line">server_config config;</div>
<div class="line">config.host = <span class="stringliteral">&quot;0.0.0.0&quot;</span>;</div>
<div class="line">config.port = 9999;</div>
<div class="line">config.max_connections = 500;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> server = log_server_factory::create_basic(config);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Start server</span></div>
<div class="line"><span class="keywordflow">if</span> (!server-&gt;start()) {</div>
<div class="line">    server_logger-&gt;log(log_level::error, <span class="stringliteral">&quot;Failed to start log server&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">server_logger-&gt;log(log_level::info,</div>
<div class="line">    <span class="stringliteral">&quot;Log server started on port &quot;</span> + std::to_string(config.port));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Monitor server health</span></div>
<div class="line"><span class="keywordflow">while</span> (server-&gt;is_running()) {</div>
<div class="line">    server_logger-&gt;log(log_level::debug, <span class="stringliteral">&quot;Server health check: OK&quot;</span>);</div>
<div class="line">    std::this_thread::sleep_for(std::chrono::minutes(1));</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>Server crash logs preserved for debugging</li>
<li>Server health monitoring with guaranteed persistence</li>
<li>Operational visibility even during server failures</li>
</ul>
<h2><a class="anchor" id="autotoc_md2128"></a>
Complete Production Topology</h2>
<p>Full production deployment with all features enabled.</p>
<div class="fragment"><div class="line"><span class="comment">// ============================================================</span></div>
<div class="line"><span class="comment">// CLIENT APPLICATION NODE</span></div>
<div class="line"><span class="comment">// ============================================================</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/safety/crash_safe_logger.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/writers/rotating_file_writer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/writers/network_writer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/writers/filtered_writer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/formatters/json_formatter.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create base logger with JSON formatting</span></div>
<div class="line"><span class="keyword">auto</span> base_logger = std::make_shared&lt;logger&gt;(<span class="keyword">true</span>, 32768);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add local crash-safe file writer (for critical logs)</span></div>
<div class="line"><span class="keyword">auto</span> local_writer = std::make_unique&lt;rotating_file_writer&gt;(</div>
<div class="line">    <span class="stringliteral">&quot;/var/log/app/critical.log&quot;</span>,</div>
<div class="line">    50 * 1024 * 1024,  <span class="comment">// 50MB per file</span></div>
<div class="line">    10                 <span class="comment">// Keep 10 files</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Filter: Only ERROR and FATAL to local file</span></div>
<div class="line"><span class="keyword">auto</span> filtered_local = std::make_unique&lt;filtered_writer&gt;(</div>
<div class="line">    std::move(local_writer),</div>
<div class="line">    log_level::error  <span class="comment">// Minimum level</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line">base_logger-&gt;add_writer(std::move(filtered_local));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add network writer (for all logs)</span></div>
<div class="line"><span class="keyword">auto</span> network = std::make_unique&lt;network_writer&gt;(</div>
<div class="line">    <span class="stringliteral">&quot;log-server.prod.internal&quot;</span>,</div>
<div class="line">    9999</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line">base_logger-&gt;add_writer(std::move(network));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wrap in crash-safe logger</span></div>
<div class="line"><span class="keyword">auto</span> app_logger = crash_safe_logger::create(base_logger);</div>
<div class="line">app_logger-&gt;install_crash_handlers();</div>
<div class="line">app_logger-&gt;set_auto_flush_interval(std::chrono::seconds(3));</div>
<div class="line">app_logger-&gt;set_min_level(log_level::info);</div>
<div class="line">app_logger-&gt;start();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ============================================================</span></div>
<div class="line"><span class="comment">// LOG SERVER (CENTRALIZED)</span></div>
<div class="line"><span class="comment">// ============================================================</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/server/log_server.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kcenon/logger/safety/crash_safe_logger.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Server&#39;s own crash-safe logger</span></div>
<div class="line"><span class="keyword">auto</span> server_logger = crash_safe_logger::create();</div>
<div class="line">server_logger-&gt;install_crash_handlers();</div>
<div class="line">server_logger-&gt;set_auto_flush_interval(std::chrono::seconds(5));</div>
<div class="line">server_logger-&gt;start();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create log server</span></div>
<div class="line">server_config server_conf;</div>
<div class="line">server_conf.host = <span class="stringliteral">&quot;0.0.0.0&quot;</span>;</div>
<div class="line">server_conf.port = 9999;</div>
<div class="line">server_conf.max_connections = 1000;</div>
<div class="line">server_conf.buffer_size = 65536;</div>
<div class="line">server_conf.enable_compression = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> log_srv = log_server_factory::create_basic(server_conf);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (!log_srv-&gt;start()) {</div>
<div class="line">    server_logger-&gt;log(log_level::fatal, <span class="stringliteral">&quot;Failed to start log server&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">server_logger-&gt;log(log_level::info,</div>
<div class="line">    <span class="stringliteral">&quot;Production log server started with crash protection&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Server monitoring loop</span></div>
<div class="line"><span class="keywordflow">while</span> (log_srv-&gt;is_running()) {</div>
<div class="line">    server_logger-&gt;log(log_level::info, <span class="stringliteral">&quot;Server operational&quot;</span>);</div>
<div class="line">    std::this_thread::sleep_for(std::chrono::minutes(5));</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Topology Diagram</b>:</p>
<div class="fragment"><div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚                 Application Node 1                       â”‚</div>
<div class="line">â”‚                                                          â”‚</div>
<div class="line">â”‚  crash_safe_logger                                       â”‚</div>
<div class="line">â”‚    â”œâ”€ rotating_file_writer (ERROR+)  â†’ /var/log/app/    â”‚</div>
<div class="line">â”‚    â””â”€ network_writer (ALL)           â†’ log-server:9999  â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                                       â”‚</div>
<div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">â”‚                 Application Node 2   â”‚                   â”‚</div>
<div class="line">â”‚                                      â”‚                   â”‚</div>
<div class="line">â”‚  crash_safe_logger                   â”‚                   â”‚</div>
<div class="line">â”‚    â”œâ”€ rotating_file_writer (ERROR+)  â”‚                   â”‚</div>
<div class="line">â”‚    â””â”€ network_writer (ALL) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚</div>
<div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                                       â”‚</div>
<div class="line">                                       â–¼</div>
<div class="line">                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">                            â”‚   log_server     â”‚</div>
<div class="line">                            â”‚ (crash_safe_loggerâ”‚</div>
<div class="line">                            â”‚   protection)    â”‚</div>
<div class="line">                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
<div class="line">                                     â”‚</div>
<div class="line">                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div>
<div class="line">                      â”‚              â”‚              â”‚</div>
<div class="line">                      â–¼              â–¼              â–¼</div>
<div class="line">               rotating_file   json_writer    syslog</div>
<div class="line">                  (hourly)     (for ELK)    (legacy)</div>
<div class="line">                      â”‚              â”‚              â”‚</div>
<div class="line">                      â–¼              â–¼              â–¼</div>
<div class="line">              /var/log/       /var/log/      syslog</div>
<div class="line">             aggregated/        json/        daemon</div>
</div><!-- fragment --><p><b>Features</b>:</p><ul>
<li>âœ… Client-side crash safety (local ERROR+ logs)</li>
<li>âœ… Server-side crash safety (server operational logs)</li>
<li>âœ… Centralized aggregation (all client logs)</li>
<li>âœ… Multi-tier filtering (local ERROR+, remote ALL)</li>
<li>âœ… High availability (local logs if network fails)</li>
<li>âœ… Compression (reduced network bandwidth)</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md2130"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md2131"></a>
Log Server</h2>
<h3><a class="anchor" id="autotoc_md2132"></a>
1. Capacity Planning</h3>
<p><b>Rule of Thumb</b>: 1 server handles ~100-500 clients depending on log volume.</p>
<p><b>Calculation</b>: </p><div class="fragment"><div class="line">Server Capacity = (Network Bandwidth / Avg Message Size) Ã— 0.7</div>
<div class="line"> </div>
<div class="line">Example:</div>
<div class="line">- Network: 1 Gbps = 125 MB/sec</div>
<div class="line">- Avg message: 250 bytes</div>
<div class="line">- Capacity: (125 MB/sec / 250 bytes) Ã— 0.7 = 350,000 msg/sec</div>
<div class="line">- If each client sends 1000 msg/sec â†’ 350 clients max</div>
</div><!-- fragment --><p><b>Recommendation</b>: Monitor CPU and network utilization; scale horizontally if &gt;70% utilized.</p>
<h3><a class="anchor" id="autotoc_md2133"></a>
2. Network Security</h3>
<p><b>Firewall Rules</b>: </p><div class="fragment"><div class="line"># Allow only internal network to log server port</div>
<div class="line">sudo iptables -A INPUT -p tcp --dport 9999 -s 10.0.0.0/8 -j ACCEPT</div>
<div class="line">sudo iptables -A INPUT -p tcp --dport 9999 -j DROP</div>
</div><!-- fragment --><p><b>TLS Configuration</b> (if <code>enable_encryption = true</code>): </p><div class="fragment"><div class="line"><span class="comment">// Future API (not yet implemented)</span></div>
<div class="line">server_config config;</div>
<div class="line">config.enable_encryption = <span class="keyword">true</span>;</div>
<div class="line"><span class="comment">// config.tls_cert_path = &quot;/etc/certs/log-server.crt&quot;;</span></div>
<div class="line"><span class="comment">// config.tls_key_path = &quot;/etc/certs/log-server.key&quot;;</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2134"></a>
3. Storage Management</h3>
<p><b>Rotate Logs Regularly</b>: </p><div class="fragment"><div class="line"><span class="comment">// Server-side storage with rotation</span></div>
<div class="line"><span class="keyword">auto</span> storage_writer = std::make_unique&lt;rotating_file_writer&gt;(</div>
<div class="line">    <span class="stringliteral">&quot;/var/log/aggregated/app.log&quot;</span>,</div>
<div class="line">    100 * 1024 * 1024,  <span class="comment">// 100MB per file</span></div>
<div class="line">    20                  <span class="comment">// Keep 20 files (2GB total)</span></div>
<div class="line">);</div>
</div><!-- fragment --><p><b>External Archival</b>: </p><div class="fragment"><div class="line"># Cron job to archive old logs to S3</div>
<div class="line">0 2 * * * /usr/local/bin/archive-logs.sh /var/log/aggregated s3://log-archive</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2135"></a>
4. Monitoring</h3>
<p><b>Metrics to Track</b>:</p><ul>
<li>Active connections (<code>max_connections</code> limit)</li>
<li>Messages received per second</li>
<li>Disk space usage</li>
<li>Network bandwidth utilization</li>
</ul>
<p><b>Health Check Script</b>: </p><div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line"># Check if log server is accepting connections</div>
<div class="line">nc -zv log-server.internal 9999</div>
<div class="line">if [ $? -eq 0 ]; then</div>
<div class="line">    echo &quot;Log server: HEALTHY&quot;</div>
<div class="line">else</div>
<div class="line">    echo &quot;Log server: DOWN&quot;</div>
<div class="line">    # Alert on-call engineer</div>
<div class="line">fi</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2136"></a>
Crash-Safe Logger</h2>
<h3><a class="anchor" id="autotoc_md2137"></a>
1. Choose Appropriate Auto-Flush Interval</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Scenario   </th><th class="markdownTableHeadNone">Recommended Interval   </th><th class="markdownTableHeadNone">Rationale    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Financial transactions</b>   </td><td class="markdownTableBodyNone">1-2 seconds   </td><td class="markdownTableBodyNone">Minimal data loss acceptable    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Web applications</b>   </td><td class="markdownTableBodyNone">5-10 seconds   </td><td class="markdownTableBodyNone">Balance durability and performance    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Batch processing</b>   </td><td class="markdownTableBodyNone">30-60 seconds   </td><td class="markdownTableBodyNone">Performance priority    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Development</b>   </td><td class="markdownTableBodyNone">Disabled (0)   </td><td class="markdownTableBodyNone">Maximize performance   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md2138"></a>
2. Test Signal Handlers</h3>
<p><b>Crash Test Program</b>: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;kcenon/logger/safety/crash_safe_logger.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> crash_test() {</div>
<div class="line">    <span class="keyword">auto</span> safe_logger = crash_safe_logger::create();</div>
<div class="line">    safe_logger-&gt;install_crash_handlers();</div>
<div class="line">    safe_logger-&gt;set_auto_flush_interval(std::chrono::seconds(5));</div>
<div class="line">    safe_logger-&gt;start();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Log some messages</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 100; ++i) {</div>
<div class="line">        safe_logger-&gt;log(log_level::info, <span class="stringliteral">&quot;Message before crash: &quot;</span> + std::to_string(i));</div>
<div class="line">        std::this_thread::sleep_for(std::chrono::milliseconds(10));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Trigger crash</span></div>
<div class="line">    safe_logger-&gt;log(log_level::fatal, <span class="stringliteral">&quot;About to crash!&quot;</span>);</div>
<div class="line">    <span class="keywordtype">int</span>* ptr = <span class="keyword">nullptr</span>;</div>
<div class="line">    *ptr = 42;  <span class="comment">// SIGSEGV</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    crash_test();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Verify Emergency Flush</b>: </p><div class="fragment"><div class="line">$ ./crash_test</div>
<div class="line"># Application crashes</div>
<div class="line"> </div>
<div class="line">$ tail /var/log/app.log</div>
<div class="line">...</div>
<div class="line">2025-02-09 14:35:22 [FATAL] About to crash!</div>
<div class="line"># âœ… Last log message was flushed before crash</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2139"></a>
3. Avoid Signal Handler Conflicts</h3>
<p><b>Check Existing Handlers</b>: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;csignal&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> check_existing_handlers() {</div>
<div class="line">    <span class="keyword">struct </span>sigaction sa;</div>
<div class="line">    sigaction(SIGSEGV, <span class="keyword">nullptr</span>, &amp;sa);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (sa.sa_handler != SIG_DFL) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Warning: SIGSEGV handler already installed\n&quot;</span>;</div>
<div class="line">        <span class="comment">// Crash-safe logger will chain to existing handler</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Multiple Libraries</b>: If other libraries (e.g., sanitizers, profilers) install signal handlers, <code>crash_safe_logger</code> will chain to them.</p>
<h3><a class="anchor" id="autotoc_md2140"></a>
4. Graceful Shutdown</h3>
<p><b>Always Flush Before Exit</b>: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> graceful_shutdown(std::shared_ptr&lt;crash_safe_logger&gt; logger) {</div>
<div class="line">    logger-&gt;log(log_level::info, <span class="stringliteral">&quot;Shutting down...&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Flush with timeout</span></div>
<div class="line">    <span class="keywordflow">if</span> (!logger-&gt;flush_with_timeout(std::chrono::seconds(5))) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Warning: Flush timeout during shutdown\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Stop logger</span></div>
<div class="line">    logger-&gt;stop();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Uninstall handlers (optional, destructor does this)</span></div>
<div class="line">    logger-&gt;uninstall_crash_handlers();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="keyword">auto</span> logger = crash_safe_logger::create();</div>
<div class="line">    logger-&gt;install_crash_handlers();</div>
<div class="line">    logger-&gt;start();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ... application logic ...</span></div>
<div class="line"> </div>
<div class="line">    graceful_shutdown(logger);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md2142"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md2143"></a>
Log Server Issues</h2>
<h3><a class="anchor" id="autotoc_md2144"></a>
Problem: Server fails to start</h3>
<p><b>Symptoms</b>: </p><div class="fragment"><div class="line"><span class="keyword">auto</span> server = log_server_factory::create_default();</div>
<div class="line"><span class="keywordflow">if</span> (!server-&gt;start()) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Server failed to start\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Possible Causes</b>:</p><ol type="1">
<li><b>Port already in use</b> <div class="fragment"><div class="line">$ sudo lsof -i :9999</div>
<div class="line">COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</div>
<div class="line">old_srv  1234 user   3u  IPv4  12345      0t0  TCP *:9999 (LISTEN)</div>
</div><!-- fragment --> <b>Solution</b>: Kill existing process or use different port.</li>
<li><b>Permission denied (port &lt; 1024)</b> <div class="fragment"><div class="line">$ ./log_server --port=514</div>
<div class="line"># Error: Permission denied</div>
</div><!-- fragment --> <b>Solution</b>: Use port â‰¥1024 or run with <code>sudo</code> (not recommended).</li>
<li><b>Server already running</b> <div class="fragment"><div class="line">server-&gt;start();  <span class="comment">// Returns true</span></div>
<div class="line">server-&gt;start();  <span class="comment">// Returns false (already running)</span></div>
</div><!-- fragment --> <b>Solution</b>: Check <code>is_running()</code> before calling <code>start()</code>.</li>
</ol>
<h3><a class="anchor" id="autotoc_md2145"></a>
Problem: Clients cannot connect</h3>
<p><b>Symptoms</b>: <code>network_writer</code> fails to connect to server.</p>
<p><b>Debugging</b>: </p><div class="fragment"><div class="line"># Check if server is listening</div>
<div class="line">$ netstat -tlnp | grep 9999</div>
<div class="line">tcp  0  0.0.0.0:9999  0.0.0.0:*  LISTEN  1234/log_server</div>
<div class="line"> </div>
<div class="line"># Test connectivity</div>
<div class="line">$ telnet log-server.internal 9999</div>
<div class="line">Trying 10.0.1.100...</div>
<div class="line">Connected to log-server.internal.</div>
</div><!-- fragment --><p><b>Possible Causes</b>:</p><ol type="1">
<li><b>Firewall blocking port</b> <div class="fragment"><div class="line">$ sudo iptables -L -n | grep 9999</div>
<div class="line">DROP  tcp  --  0.0.0.0/0  0.0.0.0/0  tcp dpt:9999</div>
</div><!-- fragment --> <b>Solution</b>: Add firewall rule to allow port 9999.</li>
<li><b>Server bound to localhost only</b> <div class="fragment"><div class="line">server_config config;</div>
<div class="line">config.host = <span class="stringliteral">&quot;localhost&quot;</span>;  <span class="comment">// Only accepts local connections</span></div>
</div><!-- fragment --> <b>Solution</b>: Bind to <code>0.0.0.0</code> for all interfaces.</li>
<li><b>DNS resolution failure</b> <div class="fragment"><div class="line">$ dig log-server.internal</div>
<div class="line"># No A record found</div>
</div><!-- fragment --> <b>Solution</b>: Use IP address or fix DNS.</li>
</ol>
<h2><a class="anchor" id="autotoc_md2146"></a>
Crash-Safe Logger Issues</h2>
<h3><a class="anchor" id="autotoc_md2147"></a>
Problem: Emergency flush not working</h3>
<p><b>Symptoms</b>: Logs missing after crash.</p>
<p><b>Debugging</b>: </p><div class="fragment"><div class="line"><span class="comment">// Add debug logging to signal handler</span></div>
<div class="line">safe_logger-&gt;log(log_level::info, <span class="stringliteral">&quot;Testing crash protection&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Trigger crash</span></div>
<div class="line"><span class="keywordtype">int</span>* ptr = <span class="keyword">nullptr</span>;</div>
<div class="line">*ptr = 42;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check if last log was written</span></div>
<div class="line">$ tail /var/log/app.log</div>
<div class="line"><span class="preprocessor"># Missing &quot;Testing crash protection&quot; message</span></div>
</div><!-- fragment --><p><b>Possible Causes</b>:</p><ol type="1">
<li><b>Signal handlers not installed</b> <div class="fragment"><div class="line"><span class="keyword">auto</span> safe_logger = crash_safe_logger::create();</div>
<div class="line"><span class="comment">// Missing: safe_logger-&gt;install_crash_handlers();</span></div>
</div><!-- fragment --> <b>Solution</b>: Call <code>install_crash_handlers()</code> after creation.</li>
<li><b>Buffer not flushed</b> <div class="fragment"><div class="line"><span class="comment">// Buffer size too large, emergency flush cannot complete in time</span></div>
<div class="line"><span class="keyword">auto</span> base_logger = std::make_shared&lt;logger&gt;(<span class="keyword">true</span>, 1048576);  <span class="comment">// 1MB</span></div>
</div><!-- fragment --> <b>Solution</b>: Use smaller buffers (16KB-64KB) for critical logs.</li>
<li><b>Lock held during crash</b> <div class="fragment"><div class="line"><span class="comment">// If crash occurs while holding flush_mutex_,</span></div>
<div class="line"><span class="comment">// emergency_flush() try_lock() will fail</span></div>
</div><!-- fragment --> <b>Solution</b>: This is inherent limitation; auto-flush mitigates risk.</li>
</ol>
<h3><a class="anchor" id="autotoc_md2148"></a>
Problem: High CPU usage from auto-flush</h3>
<p><b>Symptoms</b>: CPU usage spikes every N seconds.</p>
<p><b>Debugging</b>: </p><div class="fragment"><div class="line">$ top -p $(pgrep -f my_app)</div>
<div class="line">PID  USER  CPU%  COMMAND</div>
<div class="line">1234 user  35.0  my_app</div>
<div class="line"> </div>
<div class="line"># Periodic spikes align with auto-flush interval</div>
</div><!-- fragment --><p><b>Possible Causes</b>:</p><ol type="1">
<li><b>Auto-flush interval too short</b> <div class="fragment"><div class="line">safe_logger-&gt;set_auto_flush_interval(std::chrono::milliseconds(100));  <span class="comment">// Too frequent</span></div>
</div><!-- fragment --> <b>Solution</b>: Increase interval to 5-10 seconds.</li>
<li><b>Large buffer size</b> <div class="fragment"><div class="line"><span class="keyword">auto</span> base_logger = std::make_shared&lt;logger&gt;(<span class="keyword">true</span>, 1048576);  <span class="comment">// 1MB</span></div>
<div class="line"><span class="comment">// Flushing 1MB every second causes high I/O</span></div>
</div><!-- fragment --> <b>Solution</b>: Reduce buffer size or increase interval.</li>
</ol>
<h3><a class="anchor" id="autotoc_md2149"></a>
Problem: Signal handler conflicts</h3>
<p><b>Symptoms</b>: Application crashes without emergency flush.</p>
<p><b>Debugging</b>: </p><div class="fragment"><div class="line"><span class="comment">// Check if signal handler was overwritten</span></div>
<div class="line"><span class="preprocessor">#include &lt;csignal&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> verify_handlers() {</div>
<div class="line">    <span class="keyword">struct </span>sigaction sa;</div>
<div class="line">    sigaction(SIGSEGV, <span class="keyword">nullptr</span>, &amp;sa);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (sa.sa_handler != &amp;crash_safe_logger::signal_handler) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Warning: Signal handler overwritten\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Possible Causes</b>:</p><ol type="1">
<li><b>Another library installed handlers after crash_safe_logger</b> <div class="fragment"><div class="line">safe_logger-&gt;install_crash_handlers();  <span class="comment">// Installs handlers</span></div>
<div class="line">some_library_init();  <span class="comment">// Overwrites handlers!</span></div>
</div><!-- fragment --> <b>Solution</b>: Install crash-safe handlers LAST.</li>
<li><b>Sanitizers (ASan, TSan) override handlers</b> <div class="fragment"><div class="line">$ ASAN_OPTIONS=handle_segv=1 ./my_app</div>
<div class="line"># AddressSanitizer overrides SIGSEGV handler</div>
</div><!-- fragment --> <b>Solution</b>: Use <code>handle_segv=0</code> to let crash-safe logger handle signals.</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md2151"></a>
Related Documentation</h1>
<h2><a class="anchor" id="autotoc_md2152"></a>
Core Documentation</h2>
<ul>
<li><a class="el" href="md__2home_2runner_2work_2logger__system_2logger__system_2docs_2CONFIGURATION__STRATEGIES.html">Configuration Strategies</a> â€” Strategy pattern for environment-specific configuration</li>
<li><a class="el" href="md__2home_2runner_2work_2logger__system_2logger__system_2docs_2WRITER__GUIDE.html">Writer Guide</a> â€” Comprehensive guide to 18 writer types and decorator pattern</li>
<li><a class="el" href="md__2home_2runner_2work_2logger__system_2logger__system_2docs_2SECURITY__GUIDE.html">Security Guide</a> â€” Audit logging, sanitization, and secure key storage</li>
</ul>
<h2><a class="anchor" id="autotoc_md2153"></a>
Header Files</h2>
<ul>
<li><code>include/kcenon/logger/server/log_server.h</code> â€” Log server implementation</li>
<li><code>include/kcenon/logger/safety/crash_safe_logger.h</code> â€” Crash-safe logger implementation</li>
<li><code>include/kcenon/logger/writers/network_writer.h</code> â€” Client-side network writer</li>
</ul>
<h2><a class="anchor" id="autotoc_md2154"></a>
External Resources</h2>
<ul>
<li><a href="https://man7.org/linux/man-pages/man7/signal-safety.7.html">Async-Signal-Safe Functions</a> â€” POSIX reference</li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">ELK Stack Integration</a> â€” Elasticsearch documentation</li>
<li><a href="https://12factor.net/logs">12-Factor App Logging</a> â€” Best practices for distributed logging</li>
</ul>
<hr  />
<p><b>Document Information</b>:</p><ul>
<li><b>Authors</b>: logger_system documentation team</li>
<li><b>Last Review</b>: 2025-02-09</li>
<li><b>Version</b>: 1.0.0</li>
<li><b>Status</b>: Production Ready</li>
<li><b>Feedback</b>: Submit issues to <a href="https://github.com/kcenon/logger_system/issues">logger_system GitHub</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Feb 11 2026 23:47:04 for Logger System by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
